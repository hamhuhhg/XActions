<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XActions - Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            brand: {
              50: '#f0fdfa',
              100: '#ccfbf1',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              900: '#134e4a',
            },
            darkmain: '#0f172a',
            darkcard: '#1e293b',
            darkborder: '#334155'
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #0f172a;
    }

    ::-webkit-scrollbar-thumb {
      background: #334155;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #475569;
    }

    .glass-panel {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* JSON formatting highlighting */
    .json-key {
      color: #2dd4bf;
    }

    .json-string {
      color: #fbbf24;
    }

    .json-number {
      color: #f87171;
    }

    .json-boolean {
      color: #a78bfa;
    }

    .json-null {
      color: #9ca3af;
    }
  </style>
</head>

<body
  class="bg-darkmain text-slate-200 font-sans antialiased min-h-screen flex selection:bg-brand-500 selection:text-white">
  <!-- Sidebar Navigation -->
  <aside
    class="w-64 bg-darkcard border-r border-darkborder flex flex-col h-screen sticky top-0 shadow-2xl z-20 transition-all duration-300">
    <div class="p-6 flex items-center gap-3 border-b border-darkborder">
      <div
        class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-400 to-blue-600 flex items-center justify-center shadow-lg shadow-brand-500/20">
        <i class="fa-brands fa-x-twitter text-white text-xl"></i>
      </div>
      <div>
        <h1 class="font-bold text-xl tracking-tight text-white">XActions</h1>
        <p class="text-xs text-brand-400 font-medium tracking-wider uppercase">Ø£Ø¯ÙˆØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</p>
      </div>
    </div>
    <div class="flex-1 overflow-y-auto py-4 px-3 space-y-6">
      <!-- Data Scrapers Section -->
      <div>
        <h2 class="px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
        <nav class="space-y-1" id="nav-scrapers">
          <!-- Nav items will be populated by JS -->
        </nav>
      </div>
      <!-- Automation Tools Section -->
      <div>
        <h2 class="px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Ø¨ÙˆØªØ§Øª Ø§Ù„Ø£ØªÙ…ØªØ©</h2>
        <nav class="space-y-1" id="nav-automation">
          <!-- Nav items will be populated by JS -->
        </nav>
      </div>
    </div>
    <div class="p-4 border-t border-darkborder">
      <a href="/dashboard"
        class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-400 hover:text-white hover:bg-slate-800 transition-colors w-full text-sm">
        <i class="fa-solid fa-arrow-right"></i>
        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      </a>
    </div>
  </aside>
  <!-- Main Content Area -->
  <main
    class="flex-1 flex flex-col h-screen overflow-hidden bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoMjU1LCAyNTUsIDI1NSwgMC4wMikiLz48L3N2Zz4=')]">
    <!-- Headerbar -->
    <header class="h-20 glass-panel border-b border-darkborder flex items-center justify-between px-8 z-10">
      <div>
        <h2 id="current-tool-title" class="text-2xl font-bold text-white flex items-center gap-3">
          <i class="fa-solid fa-bolt text-brand-400"></i>
          Ø§Ø®ØªØ± Ø£Ø¯Ø§Ø©
        </h2>
        <p id="current-tool-desc" class="text-sm text-slate-400 mt-1">Ø§Ø®ØªØ± Ø£Ø¯Ø§Ø© Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ù„Ø¨Ø¯Ø¡.</p>
      </div>
      <div class="flex items-center gap-4">
        <!-- Accounts Manager Quick Set -->
        <div class="relative">
          <button onclick="openAccountsManager()"
            class="bg-darkcard border border-darkborder hover:border-brand-500/50 text-slate-300 px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 shadow-lg hover:shadow-brand-500/20">
            <i class="fa-solid fa-users text-brand-400"></i>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
          </button>
        </div>
      </div>
    </header>
    <!-- Dynamic Workspace -->
    <div class="flex-1 overflow-y-auto p-8 relative">
      <div class="max-w-7xl mx-auto space-y-6">
        <!-- Welcome State (Visible initially) -->
        <div id="welcome-state"
          class="flex flex-col items-center justify-center h-[60vh] text-center max-w-2xl mx-auto text-right">
          <div
            class="w-24 h-24 bg-darkcard rounded-2xl flex items-center justify-center mb-6 shadow-xl border border-darkborder relative mx-auto">
            <div class="absolute inset-0 bg-brand-500 rounded-2xl blur-xl opacity-20 animate-pulse-slow">
            </div>
            <i class="fa-solid fa-wand-magic-sparkles text-4xl text-brand-400"></i>
          </div>
          <h2 class="text-3xl font-bold text-white mb-4 text-center">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ø¯ÙˆØ§Øª XActions Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>
          <p class="text-slate-400 text-lg mb-8 text-center">Ù†ÙØ° Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØ£ØªÙ…ØªØ© Ù‚ÙˆÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ù…ØªØµÙØ­Ùƒ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø©
            Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø±.</p>
          <div class="grid grid-cols-2 gap-4 w-full">
            <div class="bg-darkcard p-4 rounded-xl border border-darkborder flex items-start gap-4 text-right">
              <!-- Header details -->
              <div class="flex items-center gap-3">
                <div
                  class="w-10 h-10 rounded-xl bg-indigo-500/20 text-indigo-400 flex items-center justify-center shrink-0 border border-indigo-500/30">
                  <i class="fa-solid fa-users text-lg"></i>
                </div>
                <div>
                  <h3 class="text-lg font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª X.com</h3>
                  <p class="text-xs text-slate-400">Ø£Ø¶Ù Ø­Ø³Ø§Ø¨Ø§Øª ØªÙˆÙŠØªØ± Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ø£ØªÙ…ØªØ©</p>
                </div>
              </div>
            </div>
            <div class="bg-darkcard p-4 rounded-xl border border-darkborder flex items-start gap-4 text-right">
              <div class="w-10 h-10 rounded-lg bg-brand-500/10 flex items-center justify-center shrink-0">
                <i class="fa-solid fa-robot text-brand-400"></i>
              </div>
              <div>
                <h3 class="text-white font-medium">Ø£ØªÙ…ØªØ© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h3>
                <p class="text-xs text-slate-400 mt-1">Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØŒ ÙˆØ§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø°ÙƒÙŠ.</p>
              </div>
            </div>
          </div>
        </div>
        <!-- Tool Form (Hidden initially) -->
        <div id="tool-workspace" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6">
          <!-- Configuration Panel -->
          <div class="lg:col-span-4 space-y-6">
            <div class="glass-panel rounded-2xl p-6 shadow-xl">
              <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                <i class="fa-solid fa-sliders text-slate-400"></i>
                Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
              </h3>
              <!-- Dynamic Form Injected Here -->
              <form id="dynamic-form" class="space-y-4">
                <!-- Inputs injected via JS -->
              </form>
              <div class="mt-8">
                <button id="run-btn"
                  class="w-full relative group overflow-hidden rounded-xl bg-brand-600 hover:bg-brand-500 text-white font-medium py-3 px-4 shadow-lg shadow-brand-500/25 transition-all transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
                  <span class="relative z-10 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-play"></i>
                    <span id="run-btn-text">ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©</span>
                  </span>
                  <!-- Hover effect -->
                  <div
                    class="absolute inset-0 bg-gradient-to-r from-brand-400 to-blue-500 opacity-0 group-hover:opacity-100 transition-opacity">
                  </div>
                </button>
              </div>
            </div>
            <!-- Status/Usage Card -->
            <div class="bg-darkcard rounded-2xl p-5 border border-darkborder shadow-xl">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-slate-300">Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</span>
                <span id="auth-status-badge"
                  class="px-2 py-1 rounded-md text-xs font-medium bg-slate-800 text-slate-400 flex items-center gap-1.5">
                  <span class="w-1.5 h-1.5 rounded-full bg-slate-500"></span> ØºÙŠØ± Ù…Ø­Ø¯Ø¯
                </span>
              </div>
              <p class="text-xs text-slate-500 leading-relaxed">Ø¨Ø¹Ø¶ Ù…Ù‡Ø§Ù… Ø§Ù„Ø£ØªÙ…ØªØ© ØªØªØ·Ù„Ø¨ Ø±Ù…Ø² Ù…ØµØ§Ø¯Ù‚Ø© Ù†Ø´Ø· (auth_token). Ù‚Ù…
                Ø¨ØªØ¹ÙŠÙŠÙ†Ù‡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©.</p>
            </div>
          </div>
          <!-- Results Terminal -->
          <div class="lg:col-span-8 flex flex-col h-[calc(100vh-12rem)]">
            <div
              class="glass-panel rounded-t-2xl px-4 py-3 border-b border-darkborder flex items-center justify-between shadow-sm">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-terminal text-slate-400"></i>
                <span class="text-sm font-medium text-slate-200">Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</span>
              </div>
              <div class="flex gap-2" id="export-controls" style="display: none;">
                <button onclick="copyResults()"
                  class="p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors tooltip"
                  title="Ù†Ø³Ø® Ù„Ù„Ø§Ø¦Ø­Ø©">
                  <i class="fa-regular fa-copy"></i>
                </button>
                <button onclick="downloadJSON()"
                  class="p-1.5 text-slate-400 hover:text-brand-400 hover:bg-brand-500/10 rounded transition-colors tooltip"
                  title="ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù JSON">
                  <i class="fa-solid fa-download"></i>
                </button>
              </div>
            </div>
            <div
              class="bg-[#0b1120] border-x border-b border-darkborder rounded-b-2xl flex-1 p-4 overflow-y-auto relative shadow-inner font-mono text-sm leading-relaxed text-left"
              id="terminal-output" dir="ltr">
              <div class="text-slate-500 italic flex items-center justify-center h-full">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ†ÙÙŠØ°...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <!-- UI Logic -->
  <script>
    // Store current data
    let currentToolId = null;
    let lastResultData = null;
    let xactionsAccounts = JSON.parse(localStorage.getItem('xactions_accounts')) || [];
    // Tool Configurations
    const tools = {
      // --- SCRAPERS ---
      'profile': {
        id: 'profile',
        type: 'scraper',
        title: 'Ù…Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ',
        desc: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù…Ù„Ù Ø´Ø®ØµÙŠ Ù…Ø­Ø¯Ø¯ Ø¹Ù„Ù‰ X/Twitter.',
        icon: 'fa-regular fa-id-card',
        color: 'text-blue-400',
        endpoint: '/api/new_api/profile',
        method: 'GET',
        inputs: [
          { id: 'username', label: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (Ø¨Ø¯ÙˆÙ† @)', type: 'text', placeholder: 'elonmusk', prepend: '@', required: true }
        ]
      },
      'followers': {
        id: 'followers',
        type: 'scraper',
        title: 'Ù…Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†',
        desc: 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ÙŠØªØ§Ø¨Ø¹ÙˆÙ† Ø­Ø³Ø§Ø¨Ø§Ù‹ Ù…Ø­Ø¯Ø¯Ø§Ù‹.',
        icon: 'fa-solid fa-users',
        color: 'text-indigo-400',
        endpoint: '/api/new_api/followers',
        method: 'GET',
        inputs: [
          { id: 'username', label: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù', type: 'text', placeholder: 'elonmusk', prepend: '@', required: true },
          { id: 'limit', label: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù†ØªØ§Ø¦Ø¬', type: 'number', placeholder: '100', defaultValue: 100 }
        ]
      },
      'tweets': {
        id: 'tweets',
        type: 'scraper',
        title: 'Ù…Ø­Ù…Ù„ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª',
        desc: 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù…Ù† ÙŠÙˆÙ…ÙŠØ§Øª Ù…Ù„Ù Ø´Ø®ØµÙŠ Ù…Ø­Ø¯Ø¯.',
        icon: 'fa-regular fa-comment-dots',
        color: 'text-sky-400',
        endpoint: '/api/new_api/tweets',
        method: 'GET',
        inputs: [
          { id: 'username', label: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù', type: 'text', placeholder: 'SpaceX', prepend: '@', required: true },
          { id: 'limit', label: 'Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù„Ù„ØªØºØ±ÙŠØ¯Ø§Øª', type: 'number', placeholder: '50', defaultValue: 50 },
          { id: 'includeReplies', label: 'ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø±Ø¯ÙˆØ¯ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ØŸ', type: 'checkbox', defaultValue: false }
        ]
      },
      'search': {
        id: 'search',
        type: 'scraper',
        title: 'Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¨Ø­Ø«',
        desc: 'Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù… ÙÙŠ ØªÙˆÙŠØªØ± ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.',
        icon: 'fa-solid fa-magnifying-glass',
        color: 'text-teal-400',
        endpoint: '/api/new_api/search',
        method: 'GET',
        inputs: [
          { id: 'query', label: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…ØªÙ‚Ø¯Ù…', type: 'text', placeholder: 'AI agents min_faves:1000', icon: 'fa-solid fa-search', required: true },
          { id: 'limit', label: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù†ØªØ§Ø¦Ø¬', type: 'number', placeholder: '50', defaultValue: 50 },
          { id: 'filter', label: 'Ù†ÙˆØ¹ Ø§Ù„ØªØµÙÙŠØ©', type: 'select', options: ['latest', 'top', 'people', 'photos', 'videos'], defaultValue: 'latest' }
        ]
      },
      'hashtag': {
        id: 'hashtag',
        type: 'scraper',
        title: 'Ù…Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª',
        desc: 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙØ¶Ù„ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© Ù„Ù‡Ø§Ø´ØªØ§Ø¬ Ù…Ø­Ø¯Ø¯.',
        icon: 'fa-solid fa-hashtag',
        color: 'text-purple-400',
        endpoint: '/api/new_api/hashtag',
        method: 'GET',
        inputs: [
          { id: 'tag', label: 'Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ (Ø¨Ø¯ÙˆÙ† #)', type: 'text', placeholder: 'technology', prepend: '#', required: true },
          { id: 'limit', label: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù†ØªØ§Ø¦Ø¬', type: 'number', placeholder: '50', defaultValue: 50 },
          { id: 'filter', label: 'ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ±Ø²', type: 'select', options: ['latest', 'top'], defaultValue: 'latest' }
        ]
      },
      'thread': {
        id: 'thread',
        type: 'scraper',
        title: 'Ù…Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø³Ù„Ø§Ø³Ù„',
        desc: 'ØªØ­Ù…ÙŠÙ„ Ø³Ù„Ø³Ù„Ø© ØªØºØ±ÙŠØ¯Ø§Øª ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø±Ø§Ø¨Ø· ØªØºØ±ÙŠØ¯Ø© ÙˆØ§Ø­Ø¯Ø©.',
        icon: 'fa-solid fa-bars-staggered',
        color: 'text-amber-400',
        endpoint: '/api/new_api/thread',
        method: 'GET',
        inputs: [
          { id: 'url', label: 'Ø±Ø§Ø¨Ø· Ø§Ù„ØªØºØ±ÙŠØ¯Ø©', type: 'text', placeholder: 'https://x.com/username/status/12345...', required: true }
        ]
      },
      'media': {
        id: 'media',
        type: 'scraper',
        title: 'Ù…Ø³ØªØ®Ø±Ø¬ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·',
        desc: 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† Ù…Ù„Ù Ù…Ø³ØªØ®Ø¯Ù….',
        icon: 'fa-regular fa-image',
        color: 'text-pink-400',
        endpoint: '/api/new_api/media',
        method: 'GET',
        inputs: [
          { id: 'username', label: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù', type: 'text', placeholder: 'SpaceX', prepend: '@', required: true },
          { id: 'limit', label: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ÙˆØ³Ø§Ø¦Ø·', type: 'number', placeholder: '50', defaultValue: 50 }
        ]
      },
      // --- AUTOMATION (Bots) ---
      'autoPoster': {
        id: 'autoPoster',
        type: 'action',
        title: 'Ø§Ù„Ù†Ø§Ø´Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙØ±Ø¯ÙŠ/Ø¬Ù…Ø§Ø¹ÙŠ)',
        desc: 'Ù†Ø´Ø± Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. Ø§ÙØµÙ„ Ø¨ÙŠÙ† Ø¹Ø¯Ø© ØªØºØ±ÙŠØ¯Ø§Øª Ø¨Ù€ --- Ù„Ù„Ù†Ø´Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ.',
        icon: 'fa-solid fa-paper-plane',
        color: 'text-indigo-400',
        endpoint: '/api/new_api/run',
        method: 'POST',
        requiresAuth: true,
        scriptName: 'autoPoster',
        inputs: [
          { id: 'tweets', label: 'Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØºØ±ÙŠØ¯Ø© (Ø£Ø¶Ù Ù…Ø±Ø¨Ø¹Ø§Øª Ù„Ù„Ù†Ø´Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ)', type: 'textarea-list', required: true }
        ]
      },
      'autoLike': {
        id: 'autoLike',
        type: 'action',
        title: 'Ø¨ÙˆØª Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ',
        desc: 'Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ù…Ø¹ÙŠÙ†Ø© Ø£Ùˆ Ù…Ù† Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªÙ‡Ø¯Ù Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªÙØ§Ø¹Ù„.',
        icon: 'fa-solid fa-heart',
        color: 'text-rose-400',
        endpoint: '/api/new_api/run',
        method: 'POST',
        requiresAuth: true,
        scriptName: 'autoLike',
        inputs: [
          { id: 'target_type', label: 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù', type: 'select', options: ['keyword', 'user_timeline'], defaultValue: 'keyword' },
          { id: 'target_value', label: 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù (ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù…)', type: 'text', placeholder: 'ChatGPT', required: true },
          { id: 'limit', label: 'Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù„Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª ÙÙŠ ÙƒÙ„ ØªØ´ØºÙŠÙ„', type: 'number', placeholder: '10', defaultValue: 10 }
        ]
      },
      'smartUnfollow': {
        id: 'smartUnfollow',
        type: 'action',
        title: 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„Ø°ÙƒÙŠ',
        desc: 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ù„Ø§ ÙŠØªØ§Ø¨Ø¹ÙˆÙ†ÙƒØŒ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„ÙŠÙ† Ø¨Ø£Ù…Ø§Ù†.',
        icon: 'fa-solid fa-user-minus',
        color: 'text-orange-400',
        endpoint: '/api/new_api/run',
        method: 'POST',
        requiresAuth: true,
        scriptName: 'unfollowNonFollowers',
        inputs: [
          { id: 'limit', label: 'Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù„Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', type: 'number', placeholder: '50', defaultValue: 50 }
        ]
      },
      'autoRetweet': {
        id: 'autoRetweet',
        type: 'action',
        title: 'Ø¨ÙˆØª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØºØ±ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ',
        desc: 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØºØ±ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©.',
        icon: 'fa-solid fa-retweet',
        color: 'text-green-400',
        endpoint: '/api/new_api/run',
        method: 'POST',
        requiresAuth: true,
        scriptName: 'autoRetweet',
        inputs: [
          { id: 'target_type', label: 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù', type: 'select', options: ['keyword', 'user_timeline'], defaultValue: 'keyword' },
          { id: 'target_value', label: 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù (ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù…)', type: 'text', placeholder: 'AI', required: true },
          { id: 'limit', label: 'Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØºØ±ÙŠØ¯', type: 'number', placeholder: '10', defaultValue: 10 }
        ]
      },
      'autoFollow': {
        id: 'autoFollow',
        type: 'action',
        title: 'Ø¨ÙˆØª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©',
        desc: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ØºØ±Ø¯ÙˆØ§ Ø¹Ù† ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© Ù…Ø¹ÙŠÙ†Ø©.',
        icon: 'fa-solid fa-user-plus',
        color: 'text-emerald-400',
        endpoint: '/api/new_api/run',
        method: 'POST',
        requiresAuth: true,
        scriptName: 'autoFollow',
        inputs: [
          { id: 'keyword', label: 'Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', type: 'text', placeholder: 'Web3', required: true },
          { id: 'limit', label: 'Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø§Øª', type: 'number', placeholder: '20', defaultValue: 20 }
        ]
      },
      'autoComment': {
        id: 'autoComment',
        type: 'action',
        title: 'Ø¨ÙˆØª Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©',
        desc: 'Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© Ø¨Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ø¯Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹.',
        icon: 'fa-solid fa-reply',
        color: 'text-violet-400',
        endpoint: '/api/new_api/run',
        method: 'POST',
        requiresAuth: true,
        scriptName: 'autoComment',
        inputs: [
          { id: 'target_type', label: 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù', type: 'select', options: ['keyword', 'user_timeline'], defaultValue: 'keyword' },
          { id: 'target_value', label: 'Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ù„Ù„Ø±Ø¯ (ÙƒÙ„Ù…Ø© Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù…)', type: 'text', placeholder: 'AI', required: true },
          { id: 'comment_text', label: 'Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø±Ø¯', type: 'text', placeholder: 'Great post!', required: true },
          { id: 'limit', label: 'Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù„Ù„Ø±Ø¯ÙˆØ¯', type: 'number', placeholder: '5', defaultValue: 5 }
        ]
      },
      'campaigns': {
        id: 'campaigns',
        type: 'action',
        title: 'Ø¨ÙˆØª Ø§Ù„Ø­Ù…Ù„Ø§Øª (Ù…ØªÙ‚Ø¯Ù…)',
        desc: 'Ø¨Ù†Ø§Ø¡ Ø­Ù…Ù„Ø§Øª Ù…Ø¹Ù‚Ø¯Ø© ØªØªØ¶Ù…Ù† ØªØºØ±ÙŠØ¯Ø§ØªØŒ Ø±Ø¯ÙˆØ¯ØŒ Ø§Ù‚ØªØ¨Ø§Ø³Ø§ØªØŒ ÙˆØ¬Ø¯ÙˆÙ„Ø© Ø²Ù…Ù†ÙŠØ© Ø¹Ø¨Ø± Ø¹Ø¯Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©.',
        icon: 'fa-solid fa-bullhorn',
        color: 'text-brand-400',
        method: 'POST',
        requiresAuth: true,
        isSpecialized: true,
        inputs: []
      }
    };
    // Initialize UI
    document.addEventListener('DOMContentLoaded', () => {
      renderSidebarNav();
      // Handle Run Button
      document.getElementById('run-btn').addEventListener('click', executeTool);
    });
    // Setup Sidebar Menu
    function renderSidebarNav() {
      const scrapersNav = document.getElementById('nav-scrapers');
      const automationNav = document.getElementById('nav-automation');
      Object.values(tools).forEach(tool => {
        const navItem = document.createElement('a');
        navItem.href = '#';
        navItem.className = `flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors mb-1 ${tool.type === 'action' ? 'hover:bg-rose-500/10 hover:text-rose-400 text-slate-400' : 'hover:bg-brand-500/10 hover:text-brand-400 text-slate-400'}`;
        navItem.id = `nav-item-${tool.id}`;
        navItem.onclick = (e) => {
          e.preventDefault();
          selectTool(tool.id);
        };
        navItem.innerHTML = `
                    <i class="${tool.icon} w-5 text-center ${tool.color} opacity-70 group-hover:opacity-100"></i>
                    ${tool.title}
                    ${tool.requiresAuth ? '<i class="fa-solid fa-lock text-[10px] ml-auto opacity-50" title="Requires Auth Token"></i>' : ''}
                `;
        if (tool.type === 'scraper') {
          scrapersNav.appendChild(navItem);
        } else {
          automationNav.appendChild(navItem);
        }
      });
    }
    // Handle Tool Selection
    function selectTool(toolId) {
      currentToolId = toolId;
      const tool = tools[toolId];
      // UI Updates
      document.getElementById('welcome-state').classList.add('hidden');
      document.getElementById('tool-workspace').classList.remove('hidden');
      document.getElementById('current-tool-title').innerHTML = `<i class="${tool.icon} ${tool.color}"></i> ${tool.title}`;
      document.getElementById('current-tool-desc').innerText = tool.desc;
      // Build Form
      const form = document.getElementById('dynamic-form');
      form.innerHTML = ''; // Clear existing

      if (tool.isSpecialized && tool.id === 'campaigns') {
        renderCampaignBuilder(form);
        document.getElementById('run-btn').classList.add('hidden');
        return;
      } else {
        document.getElementById('run-btn').classList.remove('hidden');
      }

      // Inject Account Selection if needed
      if (tool.requiresAuth) {
        const accWrapper = document.createElement('div');
        accWrapper.className = 'mb-4 border border-darkborder rounded-xl bg-slate-900/40 overflow-hidden';
        const header = document.createElement('div');
        header.className = 'bg-slate-900 px-4 py-2 border-b border-darkborder flex items-center justify-between';

        // Build the options string for the country filter
        let filterOptions = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆÙ„</option><option value="global">ğŸŒ ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>';
        allCountries.forEach(c => {
          filterOptions += `<option value="${c.code}">${c.flag} ${c.name}</option>`;
        });

        header.innerHTML = `
          <h4 class="text-sm font-semibold text-white flex items-center gap-2"><i class="fa-solid fa-users text-brand-400"></i> Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</h4>
          <div class="flex items-center gap-3">
            <select id="tool-accounts-filter" onchange="filterToolAccounts(this.value)" class="bg-slate-800 border border-slate-700 text-xs text-slate-300 rounded px-2 py-1.5 focus:outline-none focus:border-brand-500 appearance-none pr-6 pl-2 bg-no-repeat bg-[url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2394a3b8%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E')] bg-[length:8px_8px] bg-[position:right_6px_center]">
              ${filterOptions}
            </select>
            <button type="button" onclick="selectAllAccounts()" class="text-xs font-semibold text-brand-400 hover:text-brand-300 hover:underline transition-colors flex items-center gap-1"><i class="fa-solid fa-check-double"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
          </div>
        `;
        accWrapper.appendChild(header);
        const listDiv = document.createElement('div');
        listDiv.className = 'p-3 space-y-2 max-h-48 overflow-y-auto custom-scrollbar';
        if (xactionsAccounts.length === 0) {
          listDiv.innerHTML = '<p class="text-xs text-slate-500 text-center py-2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ©.</p>';
        } else {
          xactionsAccounts.forEach(acc => {
            const lbl = document.createElement('label');
            const flag = buildFlagEmoji(acc.country);
            lbl.className = 'flex items-center gap-3 hover:bg-slate-800/50 p-2 rounded-lg cursor-pointer transition-colors tool-account-row';
            lbl.dataset.country = acc.country || 'global';
            lbl.innerHTML = `
              <input type="checkbox" name="target_accounts" value="${acc.id}" class="w-4 h-4 text-brand-500 bg-slate-900 border-darkborder rounded focus:ring-brand-500 focus:ring-offset-darkcard account-checkbox">
              <span class="text-sm font-medium text-slate-300 select-none">${flag} ${acc.name}</span>
            `;
            listDiv.appendChild(lbl);
          });
        }
        accWrapper.appendChild(listDiv);
        form.appendChild(accWrapper);
      }

      tool.inputs.forEach(input => {
        const wrapper = document.createElement('div');
        const label = document.createElement('label');
        label.className = 'block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-1.5';
        label.innerText = input.label;
        wrapper.appendChild(label);
        let inputEl;
        if (input.type === 'select') {
          inputEl = document.createElement('select');
          inputEl.className = 'w-full bg-slate-900/50 border border-darkborder rounded-lg px-3 py-2.5 text-sm text-white focus:outline-none focus:border-brand-500 focus:bg-slate-900 transition-colors appearance-none';
          input.options.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt;
            option.innerText = opt.charAt(0).toUpperCase() + opt.slice(1).replace('_', ' ');
            if (opt === input.defaultValue) option.selected = true;
            inputEl.appendChild(option);
          });
        } else if (input.type === 'textarea-list') {
          const listWrapper = document.createElement('div');
          listWrapper.id = `textarea-list-${input.id}`;
          listWrapper.className = 'flex flex-col gap-3';
          const addTextArea = () => {
            const areaWrap = document.createElement('div');
            areaWrap.className = 'relative group';
            const area = document.createElement('textarea');
            area.className = 'w-full bg-slate-900/50 border border-darkborder rounded-lg py-2.5 px-3 text-sm text-white focus:outline-none focus:border-indigo-500 focus:bg-slate-900 transition-colors resize-y min-h-[80px] textarea-list-item';
            area.placeholder = 'Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø« Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ!';
            const removeBtn = document.createElement('button');
            removeBtn.className = 'absolute top-2 right-2 text-rose-400 hover:text-rose-300 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-800/80 rounded-md p-1';
            removeBtn.innerHTML = '<i class="fa-solid fa-xmark text-xs"></i>';
            removeBtn.onclick = (e) => { e.preventDefault(); areaWrap.remove(); };
            areaWrap.appendChild(area);
            areaWrap.appendChild(removeBtn);
            listWrapper.appendChild(areaWrap);
          };
          // Add first initial textarea
          addTextArea();
          const addBtn = document.createElement('button');
          addBtn.type = 'button';
          addBtn.className = 'self-start mt-2 text-xs font-semibold text-indigo-400 bg-indigo-500/10 hover:bg-indigo-500/20 px-3 py-1.5 rounded-md transition-colors flex items-center gap-2';
          addBtn.innerHTML = '<i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªØºØ±ÙŠØ¯Ø© Ø£Ø®Ø±Ù‰';
          addBtn.onclick = addTextArea;
          wrapper.appendChild(listWrapper);
          wrapper.appendChild(addBtn);
          inputEl = listWrapper; // Dummy assignment so it gets appended below
        } else if (input.type === 'checkbox') {
          wrapper.className = 'flex items-center gap-3 bg-slate-900/30 p-3 rounded-lg border border-darkborder/50';
          inputEl = document.createElement('input');
          inputEl.type = 'checkbox';
          inputEl.className = 'w-4 h-4 text-brand-500 bg-slate-900 border-darkborder rounded focus:ring-brand-500 focus:ring-offset-darkcard focus:ring-2';
          inputEl.checked = input.defaultValue;
          wrapper.innerHTML = '';
          wrapper.appendChild(inputEl);
          const chkLabel = document.createElement('label');
          chkLabel.className = 'text-sm font-medium text-slate-300 select-none cursor-pointer';
          chkLabel.innerText = input.label;
          wrapper.appendChild(chkLabel);
        } else {
          const inputWrapper = document.createElement('div');
          inputWrapper.className = 'relative flex items-center';
          if (input.prepend) {
            const prepend = document.createElement('span');
            prepend.className = 'absolute left-3 text-slate-500 font-medium select-none';
            prepend.innerText = input.prepend;
            inputWrapper.appendChild(prepend);
          } else if (input.icon) {
            const icon = document.createElement('i');
            icon.className = `${input.icon} absolute left-3 text-slate-500`;
            inputWrapper.appendChild(icon);
          }
          inputEl = document.createElement('input');
          inputEl.type = input.type;
          inputEl.placeholder = input.placeholder || '';
          inputEl.className = `w-full bg-slate-900/50 border border-darkborder rounded-lg py-2.5 text-sm text-white focus:outline-none focus:border-brand-500 focus:bg-slate-900 transition-colors placeholder-slate-600 ${input.prepend || input.icon ? 'pl-8 pr-3' : 'px-3'}`;
          if (input.defaultValue !== undefined) inputEl.value = input.defaultValue;
          inputWrapper.appendChild(inputEl);
          wrapper.appendChild(inputWrapper);
        }
        inputEl.id = `input-${input.id}`;
        if (input.type !== 'textarea-list') {
          inputEl.name = input.id;
          if (input.required) inputEl.required = true;
        }
        if (input.type !== 'checkbox') form.appendChild(wrapper);
        else form.appendChild(wrapper);
      });
      // Run Button color based on tool type
      const runBtn = document.getElementById('run-btn');
      if (tool.type === 'action') {
        runBtn.className = 'w-full relative group overflow-hidden rounded-xl bg-orange-600 hover:bg-orange-500 text-white font-medium py-3 px-4 shadow-lg shadow-orange-500/25 transition-all transform hover:-translate-y-0.5';
        document.getElementById('run-btn-text').innerText = 'ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØªÙ…ØªØ©';
      } else {
        runBtn.className = 'w-full relative group overflow-hidden rounded-xl bg-brand-600 hover:bg-brand-500 text-white font-medium py-3 px-4 shadow-lg shadow-brand-500/25 transition-all transform hover:-translate-y-0.5';
        document.getElementById('run-btn-text').innerText = 'Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬';
      }
      // Clean Terminal
      clearTerminal();
      printToTerminal('Ø¬Ø§Ù‡Ø². ØªÙ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù„Ù€ ' + tool.title, 'info');
      document.getElementById('export-controls').style.display = 'none';
    }
    // Execute API Call
    async function executeTool() {
      if (!currentToolId) return;
      const tool = tools[currentToolId];
      // Regular inputs
      const formInputs = document.querySelectorAll('#dynamic-form input, #dynamic-form select');
      let params = {};
      let isValid = true;
      formInputs.forEach(input => {
        if (input.required && !input.value.trim()) {
          input.classList.add('border-red-500');
          isValid = false;
        } else {
          input.classList.remove('border-red-500');
        }
        if (input.type === 'checkbox') {
          params[input.name] = input.checked;
        } else {
          params[input.name] = input.value.trim();
        }
      });

      // Textarea List Inputs (e.g., Auto Poster)
      if (tool.inputs.some(i => i.type === 'textarea-list')) {
        const listItems = document.querySelectorAll('.textarea-list-item');
        let combinedText = [];
        listItems.forEach(area => {
          const val = area.value.trim();
          if (val) combinedText.push(val);
        });

        if (combinedText.length === 0) {
          isValid = false;
          // Highlight first one
          if (listItems[0]) listItems[0].classList.add('border-red-500');
        } else {
          // Combine with the separator expected by autoPoster.js
          params['tweets'] = combinedText.join('\n---\n');
        }
      }
      if (!isValid) return printToTerminal('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.', 'error');

      let selectedAccounts = [];
      if (tool.requiresAuth) {
        const checks = document.querySelectorAll('.account-checkbox:checked');
        checks.forEach(cb => {
          const acc = xactionsAccounts.find(a => a.id == cb.value);
          if (acc) selectedAccounts.push(acc);
        });
        if (selectedAccounts.length === 0) {
          return printToTerminal('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø­Ø³Ø§Ø¨ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.', 'error');
        }
      } else {
        selectedAccounts.push({ name: 'System', token: null });
      }

      // UI Loading state
      const runBtn = document.getElementById('run-btn');
      const originalBtnHtml = runBtn.innerHTML;
      runBtn.disabled = true;
      runBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©...';
      clearTerminal();

      let allResults = [];

      try {
        for (const acc of selectedAccounts) {
          let logPrefix = tool.requiresAuth ? `[${acc.name}] ` : '';
          printToTerminal(`${logPrefix}[${new Date().toLocaleTimeString()}] Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ ${tool.title}...`, 'info');

          const method = tool.method || 'GET';
          let fetchOptions = {
            method: method,
            headers: { 'Content-Type': 'application/json' }
          };
          if (acc.token) {
            fetchOptions.headers['x-auth-token'] = acc.token;
          }
          if (method === 'GET' || method === 'HEAD') {
            const searchParams = new URLSearchParams(params);
            url += `?${searchParams.toString()}`;
          } else {
            fetchOptions.body = JSON.stringify({
              scriptName: tool.scriptName,
              options: params
            });
          }
          const response = await fetch(url, fetchOptions);
          const result = await response.json();
          if (result.success) {
            let resData = result.data || result.message;
            allResults.push({ account: acc.name, data: resData });

            if (typeof resData === 'object') {
              printToTerminal(`${logPrefix}ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ù†Ø¬Ø§Ø­. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©.`, 'success');
            } else {
              printToTerminal(`${logPrefix}${resData}`, 'success');
            }
          } else {
            printToTerminal(`${logPrefix}Ø®Ø·Ø£ ÙÙŠ API: ${result.error}`, 'error');
          }
        }

        // Output final JSON if objects were returned
        if (allResults.length > 0) {
          // If only 1 result, format as single data array, otherwise map multiple outputs
          lastResultData = allResults.length === 1 && !tool.requiresAuth ? allResults[0].data : allResults;
          const isObj = typeof lastResultData === 'object';
          document.getElementById('export-controls').style.display = isObj ? 'flex' : 'none';
          if (isObj) {
            const formattedJSON = syntaxHighlightJSON(JSON.stringify(lastResultData, null, 2));
            document.getElementById('terminal-output').innerHTML += `<div class="mt-4 pt-4 border-t border-slate-800 w-full"><pre><code>${formattedJSON}</code></pre></div>`;
          }
        }
      } catch (err) {
        printToTerminal(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©/Ø§Ù„Ù†Ø¸Ø§Ù…: ${err.message}`, 'error');
      } finally {
        runBtn.disabled = false;
        runBtn.innerHTML = originalBtnHtml;
      }
    }
    // Checkbox Helper
    function selectAllAccounts() {
      document.querySelectorAll('.account-checkbox').forEach(cb => cb.checked = true);
    }
    // Terminal Helpers
    function clearTerminal() {
      document.getElementById('terminal-output').innerHTML = '';
    }
    function printToTerminal(text, type = 'normal') {
      const terminal = document.getElementById('terminal-output');
      let color = 'text-slate-300';
      let icon = '';
      if (type === 'error') { color = 'text-red-400'; icon = '<i class="fa-solid fa-circle-xmark mr-2"></i>'; }
      if (type === 'success') { color = 'text-green-400'; icon = '<i class="fa-solid fa-check mr-2"></i>'; }
      if (type === 'info') { color = 'text-blue-400'; icon = '<i class="fa-solid fa-info-circle mr-2"></i>'; }
      terminal.innerHTML += `<div class="${color} flex flex-col md:flex-row md:items-start gap-2 mb-2 p-2 bg-[#060b14] border border-darkborder/50 rounded-lg">
        <div class="mt-0.5 shrink-0">${icon}</div>
        <span>${text}</span>
      </div>`;
      terminal.scrollTop = terminal.scrollHeight;
    }
    // Accounts Manager Status Badge Dummy (remove old logic)
    function updateAccountsBadge() {
      const badge = document.getElementById('auth-status-badge');
      if (badge) {
        badge.className = 'px-2 py-1 rounded-md text-xs font-medium bg-indigo-500/10 border border-indigo-500/20 text-indigo-400 flex items-center gap-1.5';
        badge.innerHTML = `<span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span> ${xactionsAccounts.length} Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©`;
      }
    }
    // Accounts Management
    function openAccountsManager() {
      document.getElementById('accounts-modal').classList.remove('hidden');
      renderAccountsList();
    }
    function closeAccountsManager() {
      document.getElementById('accounts-modal').classList.add('hidden');
      if (currentToolId) selectTool(currentToolId);
      updateAccountsBadge();
      editingAccountId = null; // Reset editing state when modal closes
    }

    // Tool Form Account Filtering & Selection
    function filterToolAccounts(countryCode) {
      const rows = document.querySelectorAll('.tool-account-row');
      rows.forEach(row => {
        if (countryCode === 'all' || row.dataset.country === countryCode) {
          row.style.display = 'flex';
        } else {
          row.style.display = 'none';
        }
      });
    }

    function selectAllAccounts() {
      const rows = document.querySelectorAll('.tool-account-row');
      const visibleCheckboxes = Array.from(rows)
        .filter(row => row.style.display !== 'none')
        .map(row => row.querySelector('.account-checkbox'));

      if (visibleCheckboxes.length === 0) return;

      const allChecked = visibleCheckboxes.every(cb => cb.checked);
      visibleCheckboxes.forEach(cb => cb.checked = !allChecked);
    }

    let currentCountryFilter = 'all';
    let editingAccountId = null;

    const allCountries = [
      { code: 'sa', name: 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦' },
      { code: 'eg', name: 'Ù…ØµØ±', flag: 'ğŸ‡ªğŸ‡¬' },
      { code: 'ae', name: 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª', flag: 'ğŸ‡¦ğŸ‡ª' },
      { code: 'kw', name: 'Ø§Ù„ÙƒÙˆÙŠØª', flag: 'ğŸ‡°ğŸ‡¼' },
      { code: 'qa', name: 'Ù‚Ø·Ø±', flag: 'ğŸ‡¶ğŸ‡¦' },
      { code: 'om', name: 'Ø¹ÙÙ…Ø§Ù†', flag: 'ğŸ‡´ğŸ‡²' },
      { code: 'bh', name: 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†', flag: 'ğŸ‡§ğŸ‡­' },
      { code: 'jo', name: 'Ø§Ù„Ø£Ø±Ø¯Ù†', flag: 'ğŸ‡¯ğŸ‡´' },
      { code: 'lb', name: 'Ù„Ø¨Ù†Ø§Ù†', flag: 'ğŸ‡±ğŸ‡§' },
      { code: 'sy', name: 'Ø³ÙˆØ±ÙŠØ§', flag: 'ğŸ‡¸ğŸ‡¾' },
      { code: 'iq', name: 'Ø§Ù„Ø¹Ø±Ø§Ù‚', flag: 'ğŸ‡®ğŸ‡¶' },
      { code: 'ye', name: 'Ø§Ù„ÙŠÙ…Ù†', flag: 'ğŸ‡¾ğŸ‡ª' },
      { code: 'ma', name: 'Ø§Ù„Ù…ØºØ±Ø¨', flag: 'ğŸ‡²ğŸ‡¦' },
      { code: 'dz', name: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', flag: 'ğŸ‡©ğŸ‡¿' },
      { code: 'tn', name: 'ØªÙˆÙ†Ø³', flag: 'ğŸ‡¹ğŸ‡³' },
      { code: 'ly', name: 'Ù„ÙŠØ¨ÙŠØ§', flag: 'ğŸ‡±ğŸ‡¾' },
      { code: 'sd', name: 'Ø§Ù„Ø³ÙˆØ¯Ø§Ù†', flag: 'ğŸ‡¸ğŸ‡©' },
      { code: 'ps', name: 'ÙÙ„Ø³Ø·ÙŠÙ†', flag: 'ğŸ‡µğŸ‡¸' },
      { code: 'mr', name: 'Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§', flag: 'ğŸ‡²ğŸ‡·' },
      { code: 'so', name: 'Ø§Ù„ØµÙˆÙ…Ø§Ù„', flag: 'ğŸ‡¸ğŸ‡´' },
      { code: 'dj', name: 'Ø¬ÙŠØ¨ÙˆØªÙŠ', flag: 'ğŸ‡©ğŸ‡¯' },
      { code: 'km', name: 'Ø¬Ø²Ø± Ø§Ù„Ù‚Ù…Ø±', flag: 'ğŸ‡°ğŸ‡²' },
      { code: 'us', name: 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©', flag: 'ğŸ‡ºğŸ‡¸' },
      { code: 'gb', name: 'Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠØ§', flag: 'ğŸ‡¬ğŸ‡§' },
      { code: 'ca', name: 'ÙƒÙ†Ø¯Ø§', flag: 'ğŸ‡¨ğŸ‡¦' },
      { code: 'au', name: 'Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§', flag: 'ğŸ‡¦ğŸ‡º' },
      { code: 'de', name: 'Ø£Ù„Ù…Ø§Ù†ÙŠØ§', flag: 'ğŸ‡©ğŸ‡ª' },
      { code: 'fr', name: 'ÙØ±Ù†Ø³Ø§', flag: 'ğŸ‡«ğŸ‡·' },
      { code: 'it', name: 'Ø¥ÙŠØ·Ø§Ù„ÙŠØ§', flag: 'ğŸ‡®ğŸ‡¹' },
      { code: 'es', name: 'Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§', flag: 'ğŸ‡ªğŸ‡¸' },
      { code: 'tr', name: 'ØªØ±ÙƒÙŠØ§', flag: 'ğŸ‡¹ğŸ‡·' },
      { code: 'in', name: 'Ø§Ù„Ù‡Ù†Ø¯', flag: 'ğŸ‡®ğŸ‡³' },
      { code: 'pk', name: 'Ø¨Ø§ÙƒØ³ØªØ§Ù†', flag: 'ğŸ‡µğŸ‡°' },
      { code: 'bd', name: 'Ø¨Ù†ØºÙ„Ø§Ø¯ÙŠØ´', flag: 'ğŸ‡§ğŸ‡©' },
      { code: 'id', name: 'Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ§', flag: 'ğŸ‡®ğŸ‡©' },
      { code: 'my', name: 'Ù…Ø§Ù„ÙŠØ²ÙŠØ§', flag: 'ğŸ‡²ğŸ‡¾' },
      { code: 'sg', name: 'Ø³Ù†ØºØ§ÙÙˆØ±Ø©', flag: 'ğŸ‡¸ğŸ‡¬' },
      { code: 'jp', name: 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', flag: 'ğŸ‡¯ğŸ‡µ' },
      { code: 'kr', name: 'ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©', flag: 'ğŸ‡°ğŸ‡·' },
      { code: 'cn', name: 'Ø§Ù„ØµÙŠÙ†', flag: 'ğŸ‡¨ğŸ‡³' },
      { code: 'ru', name: 'Ø±ÙˆØ³ÙŠØ§', flag: 'ğŸ‡·ğŸ‡º' },
      { code: 'br', name: 'Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„', flag: 'ğŸ‡§ğŸ‡·' },
      { code: 'ar', name: 'Ø§Ù„Ø£Ø±Ø¬Ù†ØªÙŠÙ†', flag: 'ğŸ‡¦ğŸ‡·' },
      { code: 'mx', name: 'Ø§Ù„Ù…ÙƒØ³ÙŠÙƒ', flag: 'ğŸ‡²ğŸ‡½' },
      { code: 'za', name: 'Ø¬Ù†ÙˆØ¨ Ø£ÙØ±ÙŠÙ‚ÙŠØ§', flag: 'ğŸ‡¿ğŸ‡¦' },
      { code: 'ng', name: 'Ù†ÙŠØ¬ÙŠØ±ÙŠØ§', flag: 'ğŸ‡³ğŸ‡¬' },
      { code: 'se', name: 'Ø§Ù„Ø³ÙˆÙŠØ¯', flag: 'ğŸ‡¸ğŸ‡ª' },
      { code: 'no', name: 'Ø§Ù„Ù†Ø±ÙˆÙŠØ¬', flag: 'ğŸ‡³ğŸ‡´' },
      { code: 'dk', name: 'Ø§Ù„Ø¯Ù†Ù…Ø§Ø±Ùƒ', flag: 'ğŸ‡©ğŸ‡°' },
      { code: 'fi', name: 'ÙÙ†Ù„Ù†Ø¯Ø§', flag: 'ğŸ‡«ğŸ‡®' },
      { code: 'nl', name: 'Ù‡ÙˆÙ„Ù†Ø¯Ø§', flag: 'ğŸ‡³ğŸ‡±' },
      { code: 'be', name: 'Ø¨Ù„Ø¬ÙŠÙƒØ§', flag: 'ğŸ‡§ğŸ‡ª' },
      { code: 'ch', name: 'Ø³ÙˆÙŠØ³Ø±Ø§', flag: 'ğŸ‡¨ğŸ‡­' },
      { code: 'at', name: 'Ø§Ù„Ù†Ù…Ø³Ø§', flag: 'ğŸ‡¦ğŸ‡¹' },
      { code: 'gr', name: 'Ø§Ù„ÙŠÙˆÙ†Ø§Ù†', flag: 'ğŸ‡¬ğŸ‡·' },
      { code: 'pt', name: 'Ø§Ù„Ø¨Ø±ØªØºØ§Ù„', flag: 'ğŸ‡µğŸ‡¹' },
      { code: 'ie', name: 'Ø£ÙŠØ±Ù„Ù†Ø¯Ø§', flag: 'ğŸ‡®ğŸ‡ª' },
      { code: 'nz', name: 'Ù†ÙŠÙˆØ²ÙŠÙ„Ù†Ø¯Ø§', flag: 'ğŸ‡³ğŸ‡¿' },
      { code: 'af', name: 'Ø£ÙØºØ§Ù†Ø³ØªØ§Ù†', flag: 'ğŸ‡¦ğŸ‡«' },
      { code: 'al', name: 'Ø£Ù„Ø¨Ø§Ù†ÙŠØ§', flag: 'ğŸ‡¦ğŸ‡±' },
      { code: 'ad', name: 'Ø£Ù†Ø¯ÙˆØ±Ø§', flag: 'ğŸ‡¦ğŸ‡©' },
      { code: 'ao', name: 'Ø£Ù†ØºÙˆÙ„Ø§', flag: 'ğŸ‡¦ğŸ‡´' },
      { code: 'ag', name: 'Ø£Ù†ØªÙŠØºÙˆØ§ ÙˆØ¨Ø±Ø¨ÙˆØ¯Ø§', flag: 'ğŸ‡¦ğŸ‡¬' },
      { code: 'am', name: 'Ø£Ø±Ù…ÙŠÙ†ÙŠØ§', flag: 'ğŸ‡¦ğŸ‡²' },
      { code: 'az', name: 'Ø£Ø°Ø±Ø¨ÙŠØ¬Ø§Ù†', flag: 'ğŸ‡¦ğŸ‡¿' },
      { code: 'bs', name: 'Ø¬Ø²Ø± Ø§Ù„Ø¨Ù‡Ø§Ù…Ø§', flag: 'ğŸ‡§ğŸ‡¸' },
      { code: 'bb', name: 'Ø¨Ø§Ø±Ø¨Ø§Ø¯ÙˆØ³', flag: 'ğŸ‡§ğŸ‡§' },
      { code: 'by', name: 'Ø¨ÙŠÙ„Ø§Ø±ÙˆØ³ÙŠØ§', flag: 'ğŸ‡§ğŸ‡¾' },
      { code: 'bz', name: 'Ø¨Ù„ÙŠØ²', flag: 'ğŸ‡§ğŸ‡¿' },
      { code: 'bj', name: 'Ø¨Ù†ÙŠÙ†', flag: 'ğŸ‡§ğŸ‡¯' },
      { code: 'bt', name: 'Ø¨ÙˆØªØ§Ù†', flag: 'ğŸ‡§ğŸ‡¹' },
      { code: 'bo', name: 'Ø¨ÙˆÙ„ÙŠÙÙŠØ§', flag: 'ğŸ‡§ğŸ‡´' },
      { code: 'ba', name: 'Ø§Ù„Ø¨ÙˆØ³Ù†Ø© ÙˆØ§Ù„Ù‡Ø±Ø³Ùƒ', flag: 'ğŸ‡§ğŸ‡¦' },
      { code: 'bw', name: 'Ø¨ÙˆØªØ³ÙˆØ§Ù†Ø§', flag: 'ğŸ‡§ğŸ‡¼' },
      { code: 'bn', name: 'Ø¨Ø±ÙˆÙ†Ø§ÙŠ', flag: 'ğŸ‡§ğŸ‡³' },
      { code: 'bg', name: 'Ø¨Ù„ØºØ§Ø±ÙŠØ§', flag: 'ğŸ‡§ğŸ‡¬' },
      { code: 'bf', name: 'Ø¨ÙˆØ±ÙƒÙŠÙ†Ø§ ÙØ§Ø³Ùˆ', flag: 'ğŸ‡§ğŸ‡«' },
      { code: 'bi', name: 'Ø¨ÙˆØ±ÙˆÙ†Ø¯ÙŠ', flag: 'ğŸ‡§ğŸ‡®' },
      { code: 'cv', name: 'Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø£Ø®Ø¶Ø±', flag: 'ğŸ‡¨ğŸ‡»' },
      { code: 'kh', name: 'ÙƒÙ…Ø¨ÙˆØ¯ÙŠØ§', flag: 'ğŸ‡°ğŸ‡­' },
      { code: 'cm', name: 'Ø§Ù„ÙƒØ§Ù…ÙŠØ±ÙˆÙ†', flag: 'ğŸ‡¨ğŸ‡²' },
      { code: 'cf', name: 'Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø£ÙØ±ÙŠÙ‚ÙŠØ§ Ø§Ù„ÙˆØ³Ø·Ù‰', flag: 'ğŸ‡¨ğŸ‡«' },
      { code: 'td', name: 'ØªØ´Ø§Ø¯', flag: 'ğŸ‡¹ğŸ‡©' },
      { code: 'cl', name: 'ØªØ´ÙŠÙ„ÙŠ', flag: 'ğŸ‡¨ğŸ‡±' },
      { code: 'co', name: 'ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ§', flag: 'ğŸ‡¨ğŸ‡´' },
      { code: 'cg', name: 'Ø§Ù„ÙƒÙˆÙ†ØºÙˆ', flag: 'ğŸ‡¨ğŸ‡¬' },
      { code: 'cd', name: 'Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙƒÙˆÙ†ØºÙˆ Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ©', flag: 'ğŸ‡¨ğŸ‡©' },
      { code: 'cr', name: 'ÙƒÙˆØ³ØªØ§Ø±ÙŠÙƒØ§', flag: 'ğŸ‡¨ğŸ‡·' },
      { code: 'hr', name: 'ÙƒØ±ÙˆØ§ØªÙŠØ§', flag: 'ğŸ‡­ğŸ‡·' },
      { code: 'cu', name: 'ÙƒÙˆØ¨Ø§', flag: 'ğŸ‡¨ğŸ‡º' },
      { code: 'cy', name: 'Ù‚Ø¨Ø±Øµ', flag: 'ğŸ‡¨ğŸ‡¾' },
      { code: 'cz', name: 'Ø§Ù„ØªØ´ÙŠÙƒ', flag: 'ğŸ‡¨ğŸ‡¿' },
      { code: 'do', name: 'Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†ÙŠÙƒØ§Ù†', flag: 'ğŸ‡©ğŸ‡´' },
      { code: 'ec', name: 'Ø§Ù„Ø¥ÙƒÙˆØ§Ø¯ÙˆØ±', flag: 'ğŸ‡ªğŸ‡¨' },
      { code: 'sv', name: 'Ø§Ù„Ø³Ù„ÙØ§Ø¯ÙˆØ±', flag: 'ğŸ‡¸ğŸ‡»' },
      { code: 'gq', name: 'ØºÙŠÙ†ÙŠØ§ Ø§Ù„Ø§Ø³ØªÙˆØ§Ø¦ÙŠØ©', flag: 'ğŸ‡¬ğŸ‡¶' },
      { code: 'er', name: 'Ø¥Ø±ÙŠØªØ±ÙŠØ§', flag: 'ğŸ‡ªğŸ‡·' },
      { code: 'ee', name: 'Ø¥Ø³ØªÙˆÙ†ÙŠØ§', flag: 'ğŸ‡ªğŸ‡ª' },
      { code: 'sz', name: 'Ø¥Ø³ÙˆØ§ØªÙŠÙ†ÙŠ', flag: 'ğŸ‡¸ğŸ‡¿' },
      { code: 'et', name: 'Ø¥Ø«ÙŠÙˆØ¨ÙŠØ§', flag: 'ğŸ‡ªğŸ‡¹' },
      { code: 'fj', name: 'ÙÙŠØ¬ÙŠ', flag: 'ğŸ‡«ğŸ‡¯' },
      { code: 'ga', name: 'Ø§Ù„ØºØ§Ø¨ÙˆÙ†', flag: 'ğŸ‡¬ğŸ‡¦' },
      { code: 'gm', name: 'ØºØ§Ù…Ø¨ÙŠØ§', flag: 'ğŸ‡¬ğŸ‡²' },
      { code: 'ge', name: 'Ø¬ÙˆØ±Ø¬ÙŠØ§', flag: 'ğŸ‡¬ğŸ‡ª' },
      { code: 'gh', name: 'ØºØ§Ù†Ø§', flag: 'ğŸ‡¬ğŸ‡­' },
      { code: 'gd', name: 'ØºØ±ÙŠÙ†Ø§Ø¯Ø§', flag: 'ğŸ‡¬ğŸ‡©' },
      { code: 'gt', name: 'ØºÙˆØ§ØªÙŠÙ…Ø§Ù„Ø§', flag: 'ğŸ‡¬ğŸ‡¹' },
      { code: 'gn', name: 'ØºÙŠÙ†ÙŠØ§', flag: 'ğŸ‡¬ğŸ‡³' },
      { code: 'gw', name: 'ØºÙŠÙ†ÙŠØ§ Ø¨ÙŠØ³Ø§Ùˆ', flag: 'ğŸ‡¬ğŸ‡¼' },
      { code: 'gy', name: 'ØºÙˆÙŠØ§Ù†Ø§', flag: 'ğŸ‡¬ğŸ‡¾' },
      { code: 'ht', name: 'Ù‡Ø§ÙŠØªÙŠ', flag: 'ğŸ‡­ğŸ‡¹' },
      { code: 'hn', name: 'Ù‡Ù†Ø¯ÙˆØ±Ø§Ø³', flag: 'ğŸ‡­ğŸ‡³' },
      { code: 'hu', name: 'Ø§Ù„Ù…Ø¬Ø±', flag: 'ğŸ‡­ğŸ‡º' },
      { code: 'is', name: 'Ø¢ÙŠØ³Ù„Ù†Ø¯Ø§', flag: 'ğŸ‡®ğŸ‡¸' },
      { code: 'ir', name: 'Ø¥ÙŠØ±Ø§Ù†', flag: 'ğŸ‡®ğŸ‡·' },
      { code: 'ci', name: 'Ø³Ø§Ø­Ù„ Ø§Ù„Ø¹Ø§Ø¬', flag: 'ğŸ‡¨ğŸ‡®' },
      { code: 'jm', name: 'Ø¬Ø§Ù…Ø§ÙŠÙƒØ§', flag: 'ğŸ‡¯ğŸ‡²' },
      { code: 'kz', name: 'ÙƒØ§Ø²Ø§Ø®Ø³ØªØ§Ù†', flag: 'ğŸ‡°ğŸ‡¿' },
      { code: 'ke', name: 'ÙƒÙŠÙ†ÙŠØ§', flag: 'ğŸ‡°ğŸ‡ª' },
      { code: 'ki', name: 'ÙƒÙŠØ±ÙŠØ¨Ø§ØªÙŠ', flag: 'ğŸ‡°ğŸ‡®' },
      { code: 'kp', name: 'ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©', flag: 'ğŸ‡°ğŸ‡µ' },
      { code: 'kg', name: 'Ù‚ÙŠØ±ØºÙŠØ²Ø³ØªØ§Ù†', flag: 'ğŸ‡°ğŸ‡¬' },
      { code: 'la', name: 'Ù„Ø§ÙˆØ³', flag: 'ğŸ‡±ğŸ‡¦' },
      { code: 'lv', name: 'Ù„Ø§ØªÙÙŠØ§', flag: 'ğŸ‡±ğŸ‡»' },
      { code: 'ls', name: 'Ù„ÙŠØ³ÙˆØªÙˆ', flag: 'ğŸ‡±ğŸ‡¸' },
      { code: 'lr', name: 'Ù„ÙŠØ¨ÙŠØ±ÙŠØ§', flag: 'ğŸ‡±ğŸ‡·' },
      { code: 'li', name: 'Ù„ÙŠØ®ØªÙ†Ø´ØªØ§ÙŠÙ†', flag: 'ğŸ‡±ğŸ‡®' },
      { code: 'lt', name: 'Ù„ÙŠØªÙˆØ§Ù†ÙŠØ§', flag: 'ğŸ‡±ğŸ‡¹' },
      { code: 'lu', name: 'Ù„ÙˆÙƒØ³Ù…Ø¨ÙˆØ±Øº', flag: 'ğŸ‡±ğŸ‡º' },
      { code: 'mg', name: 'Ù…Ø¯ØºØ´Ù‚Ø±', flag: 'ğŸ‡²ğŸ‡¬' },
      { code: 'mw', name: 'Ù…Ù„Ø§ÙˆÙŠ', flag: 'ğŸ‡²ğŸ‡¼' },
      { code: 'mv', name: 'Ø§Ù„Ù…Ø§Ù„Ø¯ÙŠÙ', flag: 'ğŸ‡²ğŸ‡»' },
      { code: 'ml', name: 'Ù…Ø§Ù„ÙŠ', flag: 'ğŸ‡²ğŸ‡±' },
      { code: 'mt', name: 'Ù…Ø§Ù„Ø·Ø§', flag: 'ğŸ‡²ğŸ‡¹' },
      { code: 'mh', name: 'Ø¬Ø²Ø± Ù…Ø§Ø±Ø´Ø§Ù„', flag: 'ğŸ‡²ğŸ‡­' },
      { code: 'mu', name: 'Ù…ÙˆØ±ÙŠØ´ÙŠÙˆØ³', flag: 'ğŸ‡²ğŸ‡º' },
      { code: 'fm', name: 'Ù…ÙŠÙƒØ±ÙˆÙ†ÙŠØ²ÙŠØ§', flag: 'ğŸ‡«ğŸ‡²' },
      { code: 'md', name: 'Ù…ÙˆÙ„Ø¯ÙˆÙØ§', flag: 'ğŸ‡²ğŸ‡©' },
      { code: 'mc', name: 'Ù…ÙˆÙ†Ø§ÙƒÙˆ', flag: 'ğŸ‡²ğŸ‡¨' },
      { code: 'mn', name: 'Ù…Ù†ØºÙˆÙ„ÙŠØ§', flag: 'ğŸ‡²ğŸ‡³' },
      { code: 'me', name: 'Ø§Ù„Ø¬Ø¨Ù„ Ø§Ù„Ø£Ø³ÙˆØ¯', flag: 'ğŸ‡²ğŸ‡ª' },
      { code: 'mz', name: 'Ù…ÙˆØ²Ù…Ø¨ÙŠÙ‚', flag: 'ğŸ‡²ğŸ‡¿' },
      { code: 'mm', name: 'Ù…ÙŠØ§Ù†Ù…Ø§Ø±', flag: 'ğŸ‡²ğŸ‡²' },
      { code: 'na', name: 'Ù†Ø§Ù…ÙŠØ¨ÙŠØ§', flag: 'ğŸ‡³ğŸ‡¦' },
      { code: 'nr', name: 'Ù†Ø§ÙˆØ±Ùˆ', flag: 'ğŸ‡³ğŸ‡·' },
      { code: 'np', name: 'Ù†ÙŠØ¨Ø§Ù„', flag: 'ğŸ‡³ğŸ‡µ' },
      { code: 'ni', name: 'Ù†ÙŠÙƒØ§Ø±Ø§ØºÙˆØ§', flag: 'ğŸ‡³ğŸ‡®' },
      { code: 'ne', name: 'Ø§Ù„Ù†ÙŠØ¬Ø±', flag: 'ğŸ‡³ğŸ‡ª' },
      { code: 'mk', name: 'Ù…Ù‚Ø¯ÙˆÙ†ÙŠØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©', flag: 'ğŸ‡²ğŸ‡°' },
      { code: 'pw', name: 'Ø¨Ø§Ù„Ø§Ùˆ', flag: 'ğŸ‡µğŸ‡¼' },
      { code: 'pa', name: 'Ø¨Ù†Ù…Ø§', flag: 'ğŸ‡µğŸ‡¦' },
      { code: 'pg', name: 'Ø¨Ø§Ø¨ÙˆØ§ ØºÙŠÙ†ÙŠØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', flag: 'ğŸ‡µğŸ‡¬' },
      { code: 'py', name: 'Ø¨Ø§Ø±Ø§ØºÙˆØ§ÙŠ', flag: 'ğŸ‡µğŸ‡¾' },
      { code: 'pe', name: 'Ø¨ÙŠØ±Ùˆ', flag: 'ğŸ‡µğŸ‡ª' },
      { code: 'ph', name: 'Ø§Ù„ÙÙ„Ø¨ÙŠÙ†', flag: 'ğŸ‡µğŸ‡­' },
      { code: 'pl', name: 'Ø¨ÙˆÙ„Ù†Ø¯Ø§', flag: 'ğŸ‡µğŸ‡±' },
      { code: 'ro', name: 'Ø±ÙˆÙ…Ø§Ù†ÙŠØ§', flag: 'ğŸ‡·ğŸ‡´' },
      { code: 'rw', name: 'Ø±ÙˆØ§Ù†Ø¯Ø§', flag: 'ğŸ‡·ğŸ‡¼' },
      { code: 'kn', name: 'Ø³Ø§Ù†Øª ÙƒÙŠØªØ³ ÙˆÙ†ÙŠÙÙŠØ³', flag: 'ğŸ‡°ğŸ‡³' },
      { code: 'lc', name: 'Ø³Ø§Ù†Øª Ù„ÙˆØ³ÙŠØ§', flag: 'ğŸ‡±ğŸ‡¨' },
      { code: 'vc', name: 'Ø³Ø§Ù†Øª ÙÙŠÙ†Ø³Ù†Øª ÙˆØ§Ù„ØºØ±ÙŠÙ†Ø§Ø¯ÙŠÙ†', flag: 'ğŸ‡»ğŸ‡¨' },
      { code: 'ws', name: 'Ø³Ø§Ù…ÙˆØ§', flag: 'ğŸ‡¼ğŸ‡¸' },
      { code: 'sm', name: 'Ø³Ø§Ù† Ù…Ø§Ø±ÙŠÙ†Ùˆ', flag: 'ğŸ‡¸ğŸ‡²' },
      { code: 'st', name: 'Ø³Ø§Ùˆ ØªÙˆÙ…ÙŠ ÙˆØ¨Ø±ÙŠÙ†Ø³ÙŠØ¨', flag: 'ğŸ‡¸ğŸ‡¹' },
      { code: 'sn', name: 'Ø§Ù„Ø³Ù†ØºØ§Ù„', flag: 'ğŸ‡¸ğŸ‡³' },
      { code: 'rs', name: 'ØµØ±Ø¨ÙŠØ§', flag: 'ğŸ‡·ğŸ‡¸' },
      { code: 'sc', name: 'Ø³ÙŠØ´Ù„', flag: 'ğŸ‡¸ğŸ‡¨' },
      { code: 'sl', name: 'Ø³ÙŠØ±Ø§Ù„ÙŠÙˆÙ†', flag: 'ğŸ‡¸ğŸ‡±' },
      { code: 'sk', name: 'Ø³Ù„ÙˆÙØ§ÙƒÙŠØ§', flag: 'ğŸ‡¸ğŸ‡°' },
      { code: 'si', name: 'Ø³Ù„ÙˆÙÙŠÙ†ÙŠØ§', flag: 'ğŸ‡¸ğŸ‡®' },
      { code: 'sb', name: 'Ø¬Ø²Ø± Ø³Ù„ÙŠÙ…Ø§Ù†', flag: 'ğŸ‡¸ğŸ‡§' },
      { code: 'lk', name: 'Ø³Ø±ÙŠÙ„Ø§Ù†ÙƒØ§', flag: 'ğŸ‡±ğŸ‡°' },
      { code: 'sr', name: 'Ø³ÙˆØ±ÙŠÙ†Ø§Ù…', flag: 'ğŸ‡¸ğŸ‡·' },
      { code: 'tj', name: 'Ø·Ø§Ø¬ÙŠÙƒØ³ØªØ§Ù†', flag: 'ğŸ‡¹ğŸ‡¯' },
      { code: 'tz', name: 'ØªÙ†Ø²Ø§Ù†ÙŠØ§', flag: 'ğŸ‡¹ğŸ‡¿' },
      { code: 'th', name: 'ØªØ§ÙŠÙ„Ø§Ù†Ø¯', flag: 'ğŸ‡¹ğŸ‡­' },
      { code: 'tl', name: 'ØªÙŠÙ…ÙˆØ± Ø§Ù„Ø´Ø±Ù‚ÙŠØ©', flag: 'ğŸ‡¹ğŸ‡±' },
      { code: 'tg', name: 'ØªÙˆØºÙˆ', flag: 'ğŸ‡¹ğŸ‡¬' },
      { code: 'to', name: 'ØªÙˆÙ†ØºØ§', flag: 'ğŸ‡¹ğŸ‡´' },
      { code: 'tt', name: 'ØªØ±ÙŠÙ†ÙŠØ¯Ø§Ø¯ ÙˆØªÙˆØ¨Ø§ØºÙˆ', flag: 'ğŸ‡¹ğŸ‡¹' },
      { code: 'tm', name: 'ØªØ±ÙƒÙ…Ø§Ù†Ø³ØªØ§Ù†', flag: 'ğŸ‡¹ğŸ‡²' },
      { code: 'tv', name: 'ØªÙˆÙØ§Ù„Ùˆ', flag: 'ğŸ‡¹ğŸ‡»' },
      { code: 'ug', name: 'Ø£ÙˆØºÙ†Ø¯Ø§', flag: 'ğŸ‡ºğŸ‡¬' },
      { code: 'ua', name: 'Ø£ÙˆÙƒØ±Ø§Ù†ÙŠØ§', flag: 'ğŸ‡ºğŸ‡¦' },
      { code: 'uy', name: 'Ø£ÙˆØ±ÙˆØºÙˆØ§ÙŠ', flag: 'ğŸ‡ºğŸ‡¾' },
      { code: 'uz', name: 'Ø£ÙˆØ²Ø¨ÙƒØ³ØªØ§Ù†', flag: 'ğŸ‡ºğŸ‡¿' },
      { code: 'vu', name: 'ÙØ§Ù†ÙˆØ§ØªÙˆ', flag: 'ğŸ‡»ğŸ‡º' },
      { code: 'va', name: 'Ø§Ù„ÙØ§ØªÙŠÙƒØ§Ù†', flag: 'ğŸ‡»ğŸ‡¦' },
      { code: 've', name: 'ÙÙ†Ø²ÙˆÙŠÙ„Ø§', flag: 'ğŸ‡»ğŸ‡ª' },
      { code: 'vn', name: 'ÙÙŠØªÙ†Ø§Ù…', flag: 'ğŸ‡»ğŸ‡³' },
      { code: 'zm', name: 'Ø²Ø§Ù…Ø¨ÙŠØ§', flag: 'ğŸ‡¿ğŸ‡²' },
      { code: 'zw', name: 'Ø²ÙŠÙ…Ø¨Ø§Ø¨ÙˆÙŠ', flag: 'ğŸ‡¿ğŸ‡¼' }
    ].sort((a, b) => a.name.localeCompare(b.name, 'ar'));

    function populateCountrySelects() {
      const addSelect = document.getElementById('new-account-country');
      const filterSelect = document.getElementById('filter-accounts-country');

      if (!addSelect || !filterSelect) return;

      let addHtml = '<option value="global" selected>ğŸŒ ØºÙŠØ± Ù…Ø­Ø¯Ø¯ (Ø¹Ø§Ù„Ù…ÙŠ)</option>';
      let filterHtml = '<option value="all" selected>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆÙ„</option><option value="global">ğŸŒ ØºÙŠØ± Ù…Ø­Ø¯Ø¯ (Ø¹Ø§Ù„Ù…ÙŠ)</option>';

      allCountries.forEach(country => {
        const optionString = `<option value="${country.code}">${country.flag} ${country.name}</option>`;
        addHtml += optionString;
        filterHtml += optionString;
      });

      addSelect.innerHTML = addHtml;
      filterSelect.innerHTML = filterHtml;
    }

    document.addEventListener('DOMContentLoaded', () => {
      populateCountrySelects();
      syncAccountsWithDb();
    });

    async function syncAccountsWithDb() {
      if (xactionsAccounts.length === 0) return;
      try {
        await fetch('/api/new_api/accounts/sync', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accounts: xactionsAccounts })
        });
      } catch (err) {
        console.error('Failed to sync accounts with DB:', err);
      }
    }

    function addAccount() {
      const nameInput = document.getElementById('new-account-name');
      const tokenInput = document.getElementById('new-account-token');
      const countryInput = document.getElementById('new-account-country');
      const name = nameInput.value.trim();
      const token = tokenInput.value.trim();
      const country = countryInput.value;
      if (!name || !token) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ±Ù…Ø² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©.');

      if (editingAccountId) {
        const index = xactionsAccounts.findIndex(acc => acc.id === editingAccountId);
        if (index !== -1) {
          xactionsAccounts[index] = { ...xactionsAccounts[index], name, token, country };
        }
        editingAccountId = null;
        document.getElementById('save-account-btn').innerHTML = 'Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ <i class="fa-solid fa-check ml-1"></i>';
        const cancelBtn = document.getElementById('cancel-edit-btn');
        if (cancelBtn) cancelBtn.classList.add('hidden');
      } else {
        xactionsAccounts.push({ id: Date.now(), name, token, country });
      }

      localStorage.setItem('xactions_accounts', JSON.stringify(xactionsAccounts));
      syncAccountsWithDb();

      nameInput.value = '';
      tokenInput.value = '';
      countryInput.value = 'global';
      renderAccountsList();
    }

    function cancelEdit() {
      editingAccountId = null;
      document.getElementById('new-account-name').value = '';
      document.getElementById('new-account-token').value = '';
      document.getElementById('new-account-country').value = 'global';
      document.getElementById('save-account-btn').innerHTML = 'Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ <i class="fa-solid fa-check ml-1"></i>';
      document.getElementById('cancel-edit-btn').classList.add('hidden');
    }

    function editAccount(id) {
      const acc = xactionsAccounts.find(a => a.id === id);
      if (!acc) return;
      editingAccountId = id;
      document.getElementById('new-account-name').value = acc.name;
      document.getElementById('new-account-token').value = acc.token;
      document.getElementById('new-account-country').value = acc.country || 'global';
      document.getElementById('save-account-btn').innerHTML = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨ <i class="fa-solid fa-pen ml-1"></i>';

      let cancelBtn = document.getElementById('cancel-edit-btn');
      if (!cancelBtn) {
        cancelBtn = document.createElement('button');
        cancelBtn.id = 'cancel-edit-btn';
        cancelBtn.onclick = cancelEdit;
        cancelBtn.className = "w-full mt-2 bg-slate-800 hover:bg-slate-700 text-white font-medium py-2 rounded-lg text-sm transition-colors border border-slate-700";
        cancelBtn.innerHTML = 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ <i class="fa-solid fa-xmark ml-1"></i>';
        document.getElementById('save-account-btn').parentElement.appendChild(cancelBtn);
      }
      cancelBtn.classList.remove('hidden');
    }

    function buildFlagEmoji(countryCode) {
      if (!countryCode || countryCode === 'global' || countryCode === 'other') return 'ğŸŒ';
      const country = allCountries.find(c => c.code === countryCode);
      return country ? country.flag : 'ğŸŒ';
    }

    function deleteAccount(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ')) return;
      xactionsAccounts = xactionsAccounts.filter(acc => acc.id !== id);
      if (editingAccountId === id) cancelEdit();
      localStorage.setItem('xactions_accounts', JSON.stringify(xactionsAccounts));
      syncAccountsWithDb();
      renderAccountsList();
    }

    function renderAccountsList() {
      const list = document.getElementById('accounts-list');
      const noMsg = document.getElementById('no-accounts-msg');
      list.innerHTML = '';

      let filteredAccounts = xactionsAccounts;
      if (currentCountryFilter !== 'all') {
        filteredAccounts = xactionsAccounts.filter(acc => acc.country === currentCountryFilter);
      }

      if (filteredAccounts.length === 0) {
        noMsg.classList.remove('hidden');
        if (xactionsAccounts.length > 0) {
          noMsg.innerText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆÙ„Ø©.';
        } else {
          noMsg.innerText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.';
        }
      } else {
        noMsg.classList.add('hidden');
        filteredAccounts.forEach(acc => {
          const item = document.createElement('div');

          let statusBadgeHtml = '';
          if (acc.isSuspended) {
            statusBadgeHtml = `<span class="ml-2 px-2 py-0.5 rounded text-[10px] font-bold bg-rose-500/20 text-rose-400 border border-rose-500/30">Ù…ÙˆÙ‚ÙˆÙ</span>`;
          } else if (acc.isSuspended === false) {
            statusBadgeHtml = `<span class="ml-2 px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">Ù†Ø´Ø·</span>`;
          }

          const flagEmoji = buildFlagEmoji(acc.country);

          item.className = `flex flex-col sm:flex-row items-start sm:items-center justify-between bg-[#0b1120] p-3 rounded-lg border ${acc.isSuspended ? 'border-rose-500/50 bg-rose-500/5' : 'border-darkborder'} group gap-3`;
          item.innerHTML = `
            <div class="flex items-center gap-3 overflow-hidden w-full sm:w-auto">
              <div class="w-8 h-8 rounded-full ${acc.isSuspended ? 'bg-rose-500/20 text-rose-400' : 'bg-brand-500/20 text-brand-400'} flex items-center justify-center shrink-0">
                <i class="fa-solid ${acc.isSuspended ? 'fa-user-slash' : 'fa-user'} text-sm"></i>
              </div>
              <div class="truncate">
                <p class="text-sm font-medium ${acc.isSuspended ? 'text-rose-300' : 'text-white'} truncate flex items-center pr-2">
                    ${acc.name}
                    <span class="mr-1.5 opacity-80" title="Ø¯ÙˆÙ„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨">${flagEmoji}</span>
                    ${statusBadgeHtml}
                </p>
                <p class="text-xs text-slate-500 font-mono truncate w-32 border-b border-dashed border-slate-700">***${acc.token.slice(-6)}</p>
              </div>
            </div>
            
            <div class="flex items-center gap-2 w-full sm:w-auto justify-end">
                <button onclick="openSafeBrowser(${acc.id})" id="browse-btn-${acc.id}" class="text-xs px-2.5 py-1.5 rounded bg-blue-500/10 text-blue-400 hover:text-white hover:bg-blue-600 transition-colors flex items-center gap-1.5 border border-blue-500/30" title="ØªØµÙØ­ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¢Ù…Ù†">
                  <i class="fa-solid fa-up-right-from-square"></i>
                </button>
                <button onclick="checkSingleAccount(${acc.id})" id="check-btn-${acc.id}" class="text-xs px-2.5 py-1.5 rounded bg-slate-800 text-slate-300 hover:text-white hover:bg-slate-700 transition-colors flex items-center gap-1.5 border border-slate-700" title="ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨">
                  <i class="fa-solid fa-shield-halved"></i>
                </button>
                <button onclick="editAccount(${acc.id})" class="text-slate-400 hover:text-white hover:bg-slate-800 p-2 rounded transition-colors opacity-100 sm:opacity-0 sm:group-hover:opacity-100" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨">
                  <i class="fa-solid fa-pen text-sm"></i>
                </button>
                <button onclick="deleteAccount(${acc.id})" class="text-rose-400 hover:text-rose-300 hover:bg-rose-400/10 p-2 rounded transition-colors opacity-100 sm:opacity-0 sm:group-hover:opacity-100" title="Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨">
                  <i class="fa-solid fa-trash text-sm"></i>
                </button>
            </div>
          `;
          list.appendChild(item);
        });
      }
      updateAccountsBadge();
    }
    // Export Utilities
    function copyResults() {
      if (lastResultData) {
        navigator.clipboard.writeText(JSON.stringify(lastResultData, null, 2))
          .then(() => alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!'));
      }
    }
    function downloadJSON() {
      if (lastResultData) {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(lastResultData, null, 2));
        const dlAnchorElem = document.createElement('a');
        dlAnchorElem.setAttribute("href", dataStr);
        const fileName = `xactions_${currentToolId}_${new Date().getTime()}.json`;
        dlAnchorElem.setAttribute("download", fileName);
        dlAnchorElem.click();
      }
    }
    // JSON Highlighting Logic
    function syntaxHighlightJSON(json) {
      json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        var cls = 'json-number';
        if (/^"/.test(match)) {
          if (/:$/.test(match)) {
            cls = 'json-key';
          } else {
            cls = 'json-string';
          }
        } else if (/true|false/.test(match)) {
          cls = 'json-boolean';
        } else if (/null/.test(match)) {
          cls = 'json-null';
        }
        return '<span class="' + cls + '">' + match + '</span>';
      });
    }

    // Browser Login Logic
    async function loginWithBrowser() {
      const btn = document.getElementById('btn-browser-login');
      const originalHtml = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØªØ­...';

      try {
        const response = await fetch('/api/new_api/login');
        const data = await response.json();

        if (data.success && data.token) {
          document.getElementById('new-account-token').value = data.token;
          if (data.accountName) {
            document.getElementById('new-account-name').value = data.accountName;
          }
          alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù…Ø² Ø¨Ù†Ø¬Ø§Ø­!');
        } else {
          alert('Ø®Ø·Ø£: ' + (data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.'));
        }
      } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±.');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalHtml;
      }
    }

    // Safe Browser Logic
    async function openSafeBrowser(accountId) {
      const accIndex = xactionsAccounts.findIndex(a => a.id === accountId);
      if (accIndex === -1) return;

      const acc = xactionsAccounts[accIndex];
      const btn = document.getElementById(`browse-btn-${accountId}`);
      const originalHtml = btn.innerHTML;

      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';

      try {
        const response = await fetch('/api/new_api/safe_browser', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token: acc.token })
        });

        const data = await response.json();
        if (!data.success) {
          alert(`ÙØ´Ù„ ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­: ${data.error}`);
        }
        // If success, nothing to show, the python window will pop up.
      } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Python Ùˆ nodriver.');
      } finally {
        if (document.getElementById(`browse-btn-${accountId}`)) {
          document.getElementById(`browse-btn-${accountId}`).disabled = false;
          document.getElementById(`browse-btn-${accountId}`).innerHTML = originalHtml;
        }
      }
    }

    // Suspension Checker Logic
    async function checkSingleAccount(accountId) {
      const accIndex = xactionsAccounts.findIndex(a => a.id === accountId);
      if (accIndex === -1) return;

      const acc = xactionsAccounts[accIndex];
      const btn = document.getElementById(`check-btn-${accountId}`);
      const originalHtml = btn.innerHTML;

      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';

      try {
        const response = await fetch('/api/new_api/check_suspension', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token: acc.token, username: acc.name.split(' ')[0] }) // Pass first word of name as username fallback, or modify to extract handle if saved. Here username is strictly needed by python script. Python script currently strips "@"
        });

        const data = await response.json();
        if (data.success) {
          xactionsAccounts[accIndex].isSuspended = data.isSuspended || data.doesNotExist;
          localStorage.setItem('xactions_accounts', JSON.stringify(xactionsAccounts));
          syncAccountsWithDb();
          renderAccountsList();
        } else {
          alert(`ÙØ´Ù„ à¨«Ø­Øµ ${acc.name}: ${data.error}`);
        }
      } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Python Ùˆ nodriver.');
      } finally {
        if (document.getElementById(`check-btn-${accountId}`)) {
          document.getElementById(`check-btn-${accountId}`).disabled = false;
          document.getElementById(`check-btn-${accountId}`).innerHTML = originalHtml;
        }
      }
    }

    async function checkAllAccounts() {
      if (xactionsAccounts.length === 0) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù„Ù„ÙØ­Øµ');

      const checkAllBtn = document.getElementById('btn-check-all');
      const originalHtml = checkAllBtn.innerHTML;
      checkAllBtn.disabled = true;
      checkAllBtn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';

      let suspendedCount = 0;

      for (const [index, acc] of xactionsAccounts.entries()) {
        checkAllBtn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin"></i> ${index + 1} / ${xactionsAccounts.length}...`;

        try {
          const response = await fetch('/api/new_api/check_suspension', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: acc.token, username: acc.name.split(' ')[0] })
          });

          const data = await response.json();
          if (data.success) {
            const isSusp = data.isSuspended || data.doesNotExist;
            xactionsAccounts[index].isSuspended = isSusp;
            if (isSusp) suspendedCount++;
          }
        } catch (err) {
          console.error(`Error checking ${acc.name}:`, err);
        }
      }

      localStorage.setItem('xactions_accounts', JSON.stringify(xactionsAccounts));
      syncAccountsWithDb();
      renderAccountsList();

      checkAllBtn.disabled = false;
      checkAllBtn.innerHTML = originalHtml;
      alert(`ØªÙ… ÙØ­Øµ ${xactionsAccounts.length} Ø­Ø³Ø§Ø¨Ø§Øª. ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${suspendedCount} Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚ÙˆÙ/ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.`);
    }

    let editingCampaignId = null;

    // --- Campaigns Logic ---
    function renderCampaignBuilder(container) {
      container.innerHTML = `
          <div class="flex items-center justify-between">
            <h3 class="text-sm font-bold text-white flex items-center gap-2">
              <i class="fa-solid fa-bullhorn text-brand-400"></i> Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            </h3>
            <button type="button" onclick="openCampaignsManager()" class="text-xs px-3 py-1.5 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-700 transition-all flex items-center gap-2">
              <i class="fa-solid fa-list-ul"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            </button>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-semibold uppercase text-slate-400 mb-1.5">Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø©</label>
              <input type="text" id="campaign-name" class="w-full bg-slate-900/50 border border-darkborder rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-brand-500" placeholder="Ø­Ù…Ù„Ø© Ø§Ù„Ø¹ÙŠØ¯ 2024">
            </div>
            <div>
              <label class="block text-xs font-semibold uppercase text-slate-400 mb-1.5">Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input type="datetime-local" id="campaign-schedule" class="w-full bg-slate-900/50 border border-darkborder rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-brand-500">
            </div>
          </div>
          <div id="campaign-account-selector"></div>
          <div class="bg-darkcard border border-darkborder rounded-2xl overflow-hidden shadow-xl">
            <div class="flex border-b border-darkborder bg-slate-900/80 p-1">
              <button type="button" onclick="switchCampaignTab('tweets')" class="campaign-tab-btn flex-1 py-2.5 text-xs font-bold rounded-xl transition-all text-brand-400 bg-brand-500/10 active" data-tab="tweets"><i class="fa-solid fa-feather-pointed mr-1"></i> ØªØºØ±ÙŠØ¯Ø§Øª</button>
              <button type="button" onclick="switchCampaignTab('replies')" class="campaign-tab-btn flex-1 py-2.5 text-xs font-bold rounded-xl transition-all text-slate-400 hover:text-white" data-tab="replies"><i class="fa-solid fa-reply mr-1"></i> Ø±Ø¯ÙˆØ¯</button>
              <button type="button" onclick="switchCampaignTab('quotes')" class="campaign-tab-btn flex-1 py-2.5 text-xs font-bold rounded-xl transition-all text-slate-400 hover:text-white" data-tab="quotes"><i class="fa-solid fa-quote-left mr-1"></i> Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª</button>
              <button type="button" onclick="switchCampaignTab('messages')" class="campaign-tab-btn flex-1 py-2.5 text-xs font-bold rounded-xl transition-all text-slate-400 hover:text-white" data-tab="messages"><i class="fa-solid fa-envelope mr-1"></i> Ø±Ø³Ø§Ø¦Ù„</button>
            </div>
            <div class="p-6 min-h-[350px] bg-slate-900/40 text-right" dir="rtl">
              <div id="tab-tweets" class="campaign-tab-content space-y-4">
                <div id="tweets-list" class="space-y-3"></div>
                <button type="button" onclick="addCampaignRow('tweets')" class="w-full py-3 border-2 border-dashed border-darkborder rounded-xl text-slate-500 hover:text-brand-400 hover:border-brand-500/50 transition-all text-xs font-bold flex items-center justify-center gap-2">+ Ø¥Ø¶Ø§ÙØ© ØªØºØ±ÙŠØ¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
              </div>
              <div id="tab-replies" class="campaign-tab-content hidden space-y-4">
                <div id="replies-list" class="space-y-3"></div>
                <button type="button" onclick="addCampaignRow('replies')" class="w-full py-3 border-2 border-dashed border-darkborder rounded-xl text-slate-500 hover:text-brand-400 hover:border-brand-500/50 transition-all text-xs font-bold flex items-center justify-center gap-2">+ Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙŠ</button>
              </div>
              <div id="tab-quotes" class="campaign-tab-content hidden space-y-4">
                <div id="quotes-list" class="space-y-3"></div>
                <button type="button" onclick="addCampaignRow('quotes')" class="w-full py-3 border-2 border-dashed border-darkborder rounded-xl text-slate-500 hover:text-brand-400 hover:border-brand-500/50 transition-all text-xs font-bold flex items-center justify-center gap-2">+ Ø¥Ø¶Ø§ÙØ© Ø§Ù‚ØªØ¨Ø§Ø³ Ø¬Ø¯ÙŠØ¯</button>
              </div>
              <div id="tab-messages" class="campaign-tab-content hidden space-y-4">
                <div id="messages-list" class="space-y-3"></div>
                <button type="button" onclick="addCampaignRow('messages')" class="w-full py-3 border-2 border-dashed border-darkborder rounded-xl text-slate-500 hover:text-brand-400 hover:border-brand-500/50 transition-all text-xs font-bold flex items-center justify-center gap-2">+ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ©</button>
              </div>
            </div>
          </div>
          <div class="flex gap-3">
            <button type="button" onclick="saveCampaignToDb()" class="flex-1 bg-slate-800 hover:bg-slate-700 text-slate-200 font-bold py-3.5 rounded-xl border border-slate-700 transition-all flex items-center justify-center gap-2">
              <i class="fa-solid fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©
            </button>
            <button type="button" onclick="runCampaignNow(event)" class="flex-[2] bg-brand-600 hover:bg-brand-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 transform hover:-translate-y-0.5">
              <i class="fa-solid fa-play"></i> ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¢Ù†
            </button>
          </div>
        </div>
      `;
      const accPlaceholder = document.getElementById('campaign-account-selector');
      let filterOptions = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆÙ„</option>';
      allCountries.forEach(c => filterOptions += `<option value="${c.code}">${c.flag} ${c.name}</option>`);
      accPlaceholder.innerHTML = `
        <div class="mb-4 border border-darkborder rounded-xl bg-slate-900/40 overflow-hidden">
          <div class="bg-slate-900 px-4 py-2 border-b border-darkborder flex items-center justify-between">
            <h4 class="text-sm font-semibold text-white flex items-center gap-2"><i class="fa-solid fa-users text-brand-400"></i> Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</h4>
            <select id="campaign-acc-filter" onchange="filterToolAccounts(this.value)" class="bg-slate-800 border border-slate-700 text-xs text-slate-300 rounded px-2 py-1 outline-none">${filterOptions}</select>
          </div>
          <div class="p-3 space-y-2 max-h-40 overflow-y-auto custom-scrollbar text-right" id="campaign-accounts-list" dir="rtl">
            ${xactionsAccounts.map(acc => `
              <label class="flex items-center gap-3 hover:bg-slate-800/50 p-2 rounded-lg cursor-pointer transition-colors tool-account-row" data-country="${acc.country || 'global'}">
                <input type="checkbox" name="target_accounts" value="${acc.id}" class="w-4 h-4 text-brand-500 bg-slate-900 border-darkborder rounded account-checkbox">
                <span class="text-xs text-slate-300">${buildFlagEmoji(acc.country)} ${acc.name}</span>
              </label>
            `).join('')}
          </div>
        </div>
      `;
      addCampaignRow('tweets');
    }

    function switchCampaignTab(tabId) {
      document.querySelectorAll('.campaign-tab-content').forEach(el => el.classList.add('hidden'));
      document.getElementById(`tab-${tabId}`).classList.remove('hidden');
      document.querySelectorAll('.campaign-tab-btn').forEach(btn => {
        btn.className = btn.className.replace('active bg-brand-500/10 text-brand-400', 'text-slate-400').replace('text-slate-400', 'text-slate-400');
        if (btn.dataset.tab === tabId) btn.className = btn.className.replace('text-slate-400', 'active bg-brand-500/10 text-brand-400');
      });
    }

    function updateCampaignTargetOptions() {
      const tweets = Array.from(document.querySelectorAll('#tweets-list > div')).map(row => ({
        id: row.querySelector('.camp-ref-id').value,
        text: row.querySelector('.camp-text').value.substring(0, 30) + '...'
      }));

      document.querySelectorAll('.camp-target-select').forEach(select => {
        const currentVal = select.value;
        select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØºØ±ÙŠØ¯Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© --</option>' +
          tweets.map(t => `<option value="${t.id}">${t.id}: ${t.text}</option>`).join('') +
          '<option value="manual">-- Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠ --</option>';
        if (Array.from(select.options).some(opt => opt.value === currentVal)) select.value = currentVal;
      });
    }

    function addCampaignRow(type, initialData = null) {
      const container = document.getElementById(`${type}-list`);
      const rowId = 'row-' + Math.random().toString(36).substr(2, 9);
      const div = document.createElement('div');
      div.className = 'p-4 bg-slate-900/60 border border-darkborder rounded-xl relative group animate-fade-in-up text-right';
      div.id = rowId;
      div.dir = 'rtl';

      let refId = initialData?.refId || '';
      if (type === 'tweets' && !refId) {
        const count = document.querySelectorAll('#tweets-list > div').length + 1;
        refId = `t${count}`;
      }

      const idField = `<input type="text" class="bg-slate-800/50 border border-darkborder rounded px-2 py-0.5 text-[10px] text-slate-400 focus:outline-none focus:border-brand-500 w-20 camp-ref-id" placeholder="t1" value="${refId}" dir="ltr" oninput="updateCampaignTargetOptions()">`;
      const textVal = initialData?.text || '';

      let inputHtml = '';
      if (type === 'tweets') {
        inputHtml = `
          <div class="flex justify-between items-center mb-2">
            <span class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">ØªØºØ±ÙŠØ¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
            ${idField}
          </div>
          <textarea class="w-full bg-transparent border-none text-sm text-white focus:ring-0 p-0 resize-none camp-text" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØºØ±Ø¯ØŸ" rows="2" oninput="updateCampaignTargetOptions()">${textVal}</textarea>
        `;
      } else if (type === 'messages') {
        const targetVal = initialData?.target || '';
        inputHtml = `
          <div class="flex justify-between items-center mb-2">
            <span class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Ø±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ©</span>
          </div>
          <input type="text" class="w-full bg-transparent border-none text-[11px] text-brand-400 focus:ring-0 p-0 mb-1 camp-target" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„ÙŠÙ‡..." dir="ltr" value="${targetVal}">
          <textarea class="w-full bg-transparent border-none text-sm text-white focus:ring-0 p-0 resize-none camp-text" placeholder="Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©..." rows="2">${textVal}</textarea>
        `;
      } else {
        // Replies or Quotes
        let targetVal = initialData?.target || '';
        let isManual = false;
        let selectedRef = '';
        if (targetVal.startsWith('{{') && targetVal.endsWith('}}')) {
          selectedRef = targetVal.slice(2, -2);
          targetVal = '';
        } else if (targetVal) {
          isManual = true;
        }

        inputHtml = `
          <div class="flex justify-between items-center mb-2">
            <span class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">${type === 'replies' ? 'Ø±Ø¯ Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙŠ' : 'Ø§Ù‚ØªØ¨Ø§Ø³ Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙŠ'}</span>
          </div>
          <div class="space-y-2 mb-2">
            <select class="w-full bg-slate-800/50 border border-darkborder rounded-lg px-2 py-1.5 text-xs text-slate-300 focus:outline-none focus:border-brand-500 camp-target-select" onchange="this.nextElementSibling.style.display = (this.value === 'manual' ? 'block' : 'none')">
              <option value="">-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª... --</option>
              ${isManual ? '<option value="manual" selected>-- Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠ --</option>' : ''}
              ${selectedRef ? `<option value="${selectedRef}" selected>${selectedRef}</option>` : ''}
            </select>
            <input type="text" class="w-full bg-transparent border border-darkborder/50 rounded-lg px-2 py-1 text-[11px] text-brand-400 focus:ring-0 camp-target ${isManual ? '' : 'hidden'}" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØºØ±ÙŠØ¯Ø© (URL)..." dir="ltr" value="${targetVal}">
          </div>
          <textarea class="w-full bg-transparent border-none text-sm text-white focus:ring-0 p-0 resize-none camp-text" placeholder="Ù†Øµ Ø§Ù„Ù…Ø­ØªÙˆÙ‰..." rows="2">${textVal}</textarea>
        `;
      }

      div.innerHTML = `${inputHtml}
        <div class="flex items-center justify-between mt-3 pt-3 border-t border-darkborder/30">
          <input type="hidden" class="camp-media-path" value="${initialData?.media || ''}">
          <input type="file" id="media-upload-${rowId}" class="hidden" accept="image/*,video/*" onchange="handleCampaignMediaUpload(event, '${rowId}')">
          <label for="media-upload-${rowId}" id="media-btn-${rowId}" class="cursor-pointer text-[10px] ${initialData?.media ? 'text-brand-400 font-bold' : 'text-slate-500 hover:text-brand-400'} flex items-center gap-1 transition-colors">
            <i class="fa-regular ${initialData?.media ? 'fa-image' : 'fa-image'}"></i> 
            <span class="btn-text">${initialData?.media ? 'ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©' : 'ØµÙˆØ±Ø©'}</span>
          </label>
          <button type="button" onclick="document.getElementById('${rowId}').remove(); updateCampaignTargetOptions();" class="text-rose-500/50 hover:text-rose-500"><i class="fa-solid fa-trash-can text-xs"></i></button>
        </div>`;
      container.appendChild(div);

      updateCampaignTargetOptions();
    }

    async function handleCampaignMediaUpload(event, rowId) {
      const file = event.target.files[0];
      if (!file) return;

      const btn = document.getElementById(`media-btn-${rowId}`);
      const btnText = btn.querySelector('.btn-text');
      const icon = btn.querySelector('i');
      const hiddenInput = document.querySelector(`#${rowId} .camp-media-path`);

      const originalText = btnText.innerText;

      try {
        btnText.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
        icon.className = 'fa-solid fa-spinner fa-spin';
        btn.classList.add('opacity-50', 'cursor-not-allowed');

        const extension = file.name.split('.').pop();

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async () => {
          const fileBase64 = reader.result;

          try {
            const res = await fetch('/api/new_api/upload_media', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ fileBase64, extension })
            });
            const result = await res.json();

            if (result.success) {
              hiddenInput.value = result.filePath;
              btnText.innerText = 'ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©';
              icon.className = 'fa-regular fa-image';
              btn.className = 'text-[10px] text-brand-400 font-bold flex items-center gap-1 transition-colors';
            } else {
              alert('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: ' + result.error);
              btnText.innerText = originalText;
              icon.className = 'fa-regular fa-image';
              btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
          } catch (err) {
            alert('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹');
            btnText.innerText = originalText;
            icon.className = 'fa-regular fa-image';
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
          }
        };
        reader.onerror = error => {
          alert('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error);
          btnText.innerText = originalText;
          icon.className = 'fa-regular fa-image';
          btn.classList.remove('opacity-50', 'cursor-not-allowed');
        };
      } catch (error) {
        console.error("Error converting file:", error);
      }
    }

    async function saveCampaignToDb() {
      const name = document.getElementById('campaign-name').value;
      if (!name) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù„Ù„Ø­Ù…Ù„Ø©');
        return null;
      }
      const accounts = Array.from(document.querySelectorAll('#campaign-accounts-list .account-checkbox:checked')).map(cb => cb.value);

      const extract = (typeId) => Array.from(document.querySelectorAll(`#${typeId}-list > div`)).map(row => {
        const select = row.querySelector('.camp-target-select');
        let target = row.querySelector('.camp-target')?.value;
        if (select && select.value && select.value !== 'manual') {
          target = `{{${select.value}}}`;
        }
        return {
          refId: row.querySelector('.camp-ref-id')?.value?.trim(),
          text: row.querySelector('.camp-text')?.value,
          target: target,
          media: row.querySelector('.camp-media-path')?.value || null
        };
      }).filter(c => (c.text && c.text.trim()) || (c.target && c.target.trim()) || c.media);

      const campaignData = {
        id: editingCampaignId,
        name,
        schedule: document.getElementById('campaign-schedule').value || null,
        config: { target_accounts: accounts },
        content: {
          tweets: extract('tweets'),
          replies: extract('replies'),
          quotes: extract('quotes'),
          messages: extract('messages')
        }
      };
      try {
        const res = await fetch('/api/new_api/campaigns', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(campaignData) });
        const result = await res.json();
        if (result.success) {
          alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
          editingCampaignId = result.data.id; // Store ID for future updates
          return result.data;
        } else {
          alert('Ø®Ø·Ø£: ' + result.error);
          return null;
        }
      } catch (e) {
        alert('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
        return null;
      }
    }

    function openCampaignsManager() {
      document.getElementById('campaigns-modal').classList.remove('hidden');
      loadCampaignsList();
    }

    function closeCampaignsManager() {
      document.getElementById('campaigns-modal').classList.add('hidden');
    }

    async function loadCampaignsList() {
      const container = document.getElementById('campaigns-list-container');
      container.innerHTML = '<div class="col-span-full py-12 text-center text-slate-500"><i class="fa-solid fa-spinner fa-spin text-2xl mb-4 block"></i>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª...</div>';

      try {
        const res = await fetch('/api/new_api/campaigns');
        const result = await res.json();
        if (result.success) {
          if (result.data.length === 0) {
            container.innerHTML = '<div class="col-span-full py-12 text-center text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.</div>';
            return;
          }
          container.innerHTML = '';
          result.data.forEach(camp => {
            const card = document.createElement('div');
            card.className = "bg-slate-900/60 border border-darkborder p-4 rounded-2xl flex flex-col justify-between gap-4 group hover:border-brand-500/50 transition-all";
            card.innerHTML = `
              <div class="flex items-start justify-between gap-3">
                <div class="overflow-hidden">
                  <h4 class="font-bold text-white truncate text-sm" title="${camp.name}">${camp.name}</h4>
                  <p class="text-[10px] text-slate-500 font-mono mt-0.5">${new Date(camp.createdAt).toLocaleDateString('ar-EG')} - ${camp.status || 'draft'}</p>
                </div>
                <div class="flex gap-1.5 shrink-0">
                  <button onclick="quickRunCampaign('${camp.id}')" class="w-8 h-8 rounded-lg bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white transition-all flex items-center justify-center border border-emerald-500/20" title="ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù†">
                    <i class="fa-solid fa-play text-[10px]"></i>
                  </button>
                  <button onclick="editCampaign('${camp.id}')" class="w-8 h-8 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-600 hover:text-white transition-all flex items-center justify-center border border-blue-500/20" title="ØªØ¹Ø¯ÙŠÙ„">
                    <i class="fa-solid fa-pen text-[10px]"></i>
                  </button>
                  <button onclick="deleteCampaignFromList('${camp.id}')" class="w-8 h-8 rounded-lg bg-rose-500/10 text-rose-400 hover:bg-rose-500 hover:text-white transition-all flex items-center justify-center border border-rose-500/20" title="Ø­Ø°Ù">
                    <i class="fa-solid fa-trash text-[10px]"></i>
                  </button>
                </div>
              </div>
            `;
            container.appendChild(card);
          });
        }
      } catch (e) {
        container.innerHTML = '<div class="col-span-full py-12 text-center text-rose-400">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª.</div>';
      }
    }

    async function editCampaign(id) {
      try {
        // We fetch the full list or single if API supported, but here list works
        const res = await fetch('/api/new_api/campaigns');
        const result = await res.json();
        const camp = result.data.find(c => c.id === id);
        if (!camp) return alert('Ø§Ù„Ø­Ù…Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');

        // Populate builder
        editingCampaignId = camp.id;
        document.getElementById('campaign-name').value = camp.name;
        document.getElementById('campaign-schedule').value = camp.schedule ? camp.schedule.slice(0, 16) : '';

        const config = JSON.parse(camp.config || '{}');
        const content = JSON.parse(camp.content || '{}');

        // Reset and Populate Tabs
        ['tweets', 'replies', 'quotes', 'messages'].forEach(type => {
          const list = document.getElementById(`${type}-list`);
          list.innerHTML = '';
          if (content[type] && Array.isArray(content[type])) {
            content[type].forEach(row => {
              addCampaignRow(type, row);
            });
          }
        });

        // Select Accounts
        const accountsList = document.querySelectorAll('#campaign-accounts-list .account-checkbox');
        const targetAccs = config.target_accounts || [];
        accountsList.forEach(cb => {
          cb.checked = targetAccs.includes(cb.value);
        });

        closeCampaignsManager();
        alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø© Ù„Ù„Ù…Ø­Ø±Ø± Ø¨Ù†Ø¬Ø§Ø­!');
      } catch (e) {
        console.error(e);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø©');
      }
    }

    async function quickRunCampaign(id) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¢Ù†ØŸ')) return;
      try {
        await syncAccountsWithDb();
        const res = await fetch(`/api/new_api/campaigns/${id}/execute`, { method: 'POST' });
        const result = await res.json();
        if (result.success) {
          alert('Ø¨Ø¯Ø£ ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
          closeCampaignsManager();
        } else {
          alert('Ø®Ø·Ø£: ' + result.error);
        }
      } catch (e) {
        alert('ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©');
      }
    }

    async function deleteCampaignFromList(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù…Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
      try {
        const res = await fetch(`/api/new_api/campaigns/${id}`, { method: 'DELETE' });
        const result = await res.json();
        if (result.success) {
          loadCampaignsList();
        } else {
          alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
        }
      } catch (e) {
        alert('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
      }
    }

    async function runCampaignNow(event) {
      const btn = event.currentTarget;
      const originalHtml = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø¯Ø¡...';

      try {
        await syncAccountsWithDb();
        const campaign = await saveCampaignToDb();
        if (!campaign) return;

        const res = await fetch(`/api/new_api/campaigns/${campaign.id}/execute`, { method: 'POST' });
        const result = await res.json();
        if (result.success) {
          alert('Ø¨Ø¯Ø£ ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
        } else {
          alert('Ø®Ø·Ø£: ' + result.error);
        }
      } catch (e) {
        alert('ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalHtml;
      }
    }

  </script>

  <!-- Accounts Manager Modal -->
  <div id="accounts-modal"
    class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
    <div
      class="bg-darkcard border border-darkborder rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden transform transition-all">
      <div class="px-6 py-4 border-b border-darkborder flex items-center justify-between bg-slate-900/50">
        <h3 class="text-lg font-bold text-white flex items-center gap-2">
          <i class="fa-solid fa-users text-brand-400"></i>
          Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        </h3>
        <div class="flex items-center gap-3">
          <button onclick="checkAllAccounts()" id="btn-check-all"
            class="text-xs px-3 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white rounded-lg transition border border-slate-700 flex items-center gap-2">
            <i class="fa-solid fa-shield-halved text-brand-400"></i> ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
          </button>
          <button onclick="closeAccountsManager()" class="text-slate-400 hover:text-white transition-colors p-1">
            <i class="fa-solid fa-xmark text-lg"></i>
          </button>
        </div>
      </div>

      <div class="p-6">
        <!-- Add Account Form -->
        <div class="bg-slate-900/50 rounded-xl p-4 border border-darkborder mb-6">
          <h4 class="text-sm font-semibold text-white mb-3 flex items-center gap-2">
            <i class="fa-solid fa-plus text-emerald-400"></i> Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
            <div>
              <label class="block text-xs text-slate-400 mb-1">Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ù„Ù„ØªÙˆØ¶ÙŠØ­ ÙÙ‚Ø·)</label>
              <input type="text" id="new-account-name" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ"
                class="w-full bg-[#0b1120] border border-darkborder rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-brand-500">
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Ø¯ÙˆÙ„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</label>
              <select id="new-account-country"
                class="w-full bg-[#0b1120] border border-darkborder rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-brand-500 appearance-none bg-no-repeat bg-[url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2394a3b8%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E')] bg-[length:12px_12px] bg-[position:left_12px_center]">
                <!-- Injected via JS -->
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Ø±Ù…Ø² auth_token</label>
              <div class="flex gap-2">
                <input type="password" id="new-account-token" placeholder="Ø±Ù…Ø² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©..."
                  class="flex-1 w-full bg-[#0b1120] border border-darkborder rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-brand-500 font-mono"
                  dir="ltr">
                <button type="button" id="btn-browser-login" onclick="loginWithBrowser()"
                  class="bg-blue-600/20 text-blue-400 hover:bg-blue-600 hover:text-white border border-blue-500/30 font-medium px-3 py-2 rounded-lg text-xs transition-colors whitespace-nowrap flex items-center gap-2"
                  title="Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙˆÙƒÙ† Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
                  <i class="fa-brands fa-x-twitter"></i> ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ù…ØªØµÙØ­
                </button>
              </div>
            </div>
          </div>
          <div>
            <button onclick="addAccount()" id="save-account-btn"
              class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-medium py-2 rounded-lg text-sm transition-colors">
              Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ <i class="fa-solid fa-check ml-1"></i>
            </button>
          </div>
        </div>

        <!-- Accounts List -->
        <div>
          <div class="flex items-center justify-between mb-3 border-b border-darkborder/50 pb-2">
            <h4 class="text-sm font-semibold text-white">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h4>
            <div class="flex items-center gap-2">
              <label class="text-xs text-slate-400">ØªØµÙÙŠØ©:</label>
              <select id="filter-accounts-country" onchange="currentCountryFilter = this.value; renderAccountsList();"
                class="bg-[#0b1120] border border-darkborder rounded p-1 text-xs text-slate-300 focus:outline-none focus:border-brand-500 appearance-none bg-no-repeat bg-[url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2394a3b8%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E')] bg-[length:10px_10px] bg-[position:left_6px_center] pl-5 pr-2 w-32">
                <!-- Injected via JS -->
              </select>
            </div>
          </div>
          <div id="accounts-list" class="space-y-2 max-h-60 overflow-y-auto pr-1 custom-scrollbar">
            <!-- Account items will be appended here by JS -->
          </div>
          <div id="no-accounts-msg" class="text-center py-6 text-slate-500 text-sm hidden">
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Campaigns Manager Modal -->
  <div id="campaigns-modal"
    class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm hidden">
    <div
      class="bg-darkcard w-full max-w-4xl max-h-[90vh] rounded-3xl border border-darkborder shadow-2xl flex flex-col overflow-hidden animate-fade-in border-t-4 border-t-brand-500">
      <div class="p-6 border-b border-darkborder flex items-center justify-between bg-slate-900/50">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-brand-500/10 flex items-center justify-center text-brand-400">
            <i class="fa-solid fa-bullhorn text-lg"></i>
          </div>
          <div>
            <h3 class="text-xl font-bold text-white leading-tight">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª</h3>
            <p class="text-sm text-slate-400">Ø¹Ø±Ø¶ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ Ø£Ùˆ ØªØ´ØºÙŠÙ„ Ø­Ù…Ù„Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
          </div>
        </div>
        <button onclick="closeCampaignsManager()"
          class="w-10 h-10 rounded-xl hover:bg-slate-800 text-slate-400 transition-colors flex items-center justify-center">
          <i class="fa-solid fa-times text-xl"></i>
        </button>
      </div>

      <div class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar bg-[#0f172a]/30">
        <div id="campaigns-list-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Campaigns will be loaded here -->
          <div class="col-span-full py-12 text-center text-slate-500">
            <i class="fa-solid fa-spinner fa-spin text-2xl mb-4 block"></i>
            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª...
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>